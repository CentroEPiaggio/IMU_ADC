C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE IMU_FUNCTIONS
OBJECT MODULE PLACED IN .\DP8051_Keil_951\Debug\IMU_functions.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\4.2\PSoC Creator\import\keil\pk51\9.51\C51\BIN\c51.exe 
                    -IMU_functions.c NOIV LARGE MODDP2 OMF2 VB(1) NOIP INCDIR(.,Generated_Source\PSoC3) FF(3) DB WL(2) PR(.\DP8051_Keil_951\D
                    -ebug/IMU_functions.lst) CD OT(2,SIZE) OJ(.\DP8051_Keil_951\Debug\IMU_functions.obj)

line level    source

   1          // ----------------------------------------------------------------------------
   2          // BSD 3-Clause License
   3          
   4          // Copyright (c) 2016, qbrobotics
   5          // Copyright (c) 2017-2018, Centro "E.Piaggio"
   6          // All rights reserved.
   7          
   8          // Redistribution and use in source and binary forms, with or without
   9          // modification, are permitted provided that the following conditions are met:
  10          
  11          // * Redistributions of source code must retain the above copyright notice, this
  12          //   list of conditions and the following disclaimer.
  13          
  14          // * Redistributions in binary form must reproduce the above copyright notice,
  15          //   this list of conditions and the following disclaimer in the documentation
  16          //   and/or other materials provided with the distribution.
  17          
  18          // * Neither the name of the copyright holder nor the names of its
  19          //   contributors may be used to endorse or promote products derived from
  20          //   this software without specific prior written permission.
  21          
  22          // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  23          // AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  24          // IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
  25          // DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
  26          // FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
  27          // DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
  28          // SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
  29          // CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
  30          // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  31          // OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  32          // POSSIBILITY OF SUCH DAMAGE.
  33          // ----------------------------------------------------------------------------
  34          
  35          /**
  36          * \file         IMU_functions.c
  37          *
  38          * \brief        Implementation of IMU module functions.
  39          * \date         February 01, 2018
  40          * \author       _Centro "E.Piaggio"_
  41          * \copyright    (C) 2012-2016 qbrobotics. All rights reserved.
  42          * \copyright    (C) 2017-2018 Centro "E.Piaggio". All rights reserved.
  43          */
  44          
  45          #include <IMU_functions.h>
  46          #include <SPI_IMU.h>
  47          
  48          extern uint8 Accel[N_IMU_MAX][6];
  49          extern uint8 Gyro[N_IMU_MAX][6];
  50          extern uint8 Mag[N_IMU_MAX][6];
  51          extern uint8 MagCal[N_IMU_MAX][3];
  52          
  53          /*******************************************************************************
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 2   

  54          * Function Name: Imus Reset
  55          *********************************************************************************/      
  56          void ImusReset() {
  57   1      
  58   1          Opto_Pin_Write(0);
  59   1          CyDelay(10);
  60   1          Opto_Pin_Write(1);
  61   1          CyDelay(10);
  62   1          InitIMUgeneral();
  63   1      
  64   1          CyDelay(10);
  65   1      }
  66          
  67          /*******************************************************************************
  68          * Function Name: IMU Initialization
  69          *********************************************************************************/
  70          void InitIMU(){ 
  71   1          
  72   1              WriteControlRegister(MPU9250_PWR_MGMT_1, 0x10); 
  73   1              CyDelay(10);    
  74   1              WriteControlRegister(MPU9250_USER_CTRL, 0x20);  //I2C master enable - disable I2C (prima 0x30)
  75   1              CyDelay(10);
  76   1          WriteControlRegister(MPU9250_CONFIG, 0x06); //Gyro & Temp Low Pass Filter 0x01 = 184Hz, 0x02 = 92Hz, 0
             -x04 = 20Hz, 0x05 = 10Hz
  77   1          CyDelay(10);        
  78   1              WriteControlRegister(MPU9250_GYRO_CONFIG , GYRO_SF_2000); //Gyro full scale select 0x00=250Â°/s 0x80=500Â
             -°/s 0x18=2000Â°/s 
  79   1              CyDelay(10);
  80   1          WriteControlRegister(MPU9250_ACCEL_CONFIG, ACC_SF_2G); // Acc full scale select 0x00 = 2g 0x08 = 4g 0x
             -10 = 8g 0x18 = 16g
  81   1          CyDelay(10);
  82   1      #ifdef SOMA    
                  WriteControlRegister(MPU9250_ACCEL_CONFIG2, LP_ACC_FREQ_184);
              #else
  85   1          WriteControlRegister(MPU9250_ACCEL_CONFIG2, LP_ACC_FREQ_10);
  86   1      #endif    
  87   1          CyDelay(10);
  88   1              //mag register
  89   1              WriteControlRegister(MPU9250_I2C_MST_CTRL, 0x0D); //set slave I2C speed
  90   1              CyDelay(10);
  91   1              //SLV0 (use to write)
  92   1              WriteControlRegister(MPU9250_I2C_SLV0_ADDR, 0x0C); //set compass address
  93   1              CyDelay(10);                    
  94   1              WriteControlRegister(MPU9250_I2C_SLV0_REG, AK8936_CNTL); //compass mode register
  95   1              CyDelay(10);    
  96   1              // Istruction used to read Compass
  97   1              WriteControlRegister(MPU9250_I2C_SLV0_D0, 0x16); //0x12 continuous mode1  0x16 continuous mode2
  98   1              CyDelay(10);
  99   1              WriteControlRegister(MPU9250_I2C_SLV0_CTRL, 0x81); //enable data from register + 1 bit to write
 100   1              CyDelay(10);
 101   1              //SLV0 (use to read)
 102   1              WriteControlRegister(MPU9250_I2C_SLV0_ADDR, 0x8C); // RCR  | AK8963_address (0x0C) 
 103   1              CyDelay(10);
 104   1              // Istruction used to read Compass
 105   1              WriteControlRegister(MPU9250_I2C_SLV0_REG, 0x03); // 0x03:start from Xout Low in case of calibration 0x10
             -:start from ASAX
 106   1              CyDelay(10);
 107   1              // Istruction used to read Compass
 108   1              WriteControlRegister(MPU9250_I2C_SLV0_CTRL, 0x8D); //How many bits read  SEMPRE DISPARI 0x8D era quella c
             -he funzionava
 109   1              CyDelay(10);
 110   1              WriteControlRegister(MPU9250_PWR_MGMT_1, 0x00); 
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 3   

 111   1              CyDelay(20);
 112   1      }       
 113          
 114          /*******************************************************************************
 115          * Function Name: IMU Mag Cal Initialization
 116          *********************************************************************************/
 117          void InitIMUMagCal(){   
 118   1          
 119   1              WriteControlRegister(MPU9250_PWR_MGMT_1, 0x10); 
 120   1              CyDelay(10);    
 121   1              WriteControlRegister(MPU9250_USER_CTRL, 0x20);  //I2C master enable - disable I2C (prima 0x30)
 122   1              CyDelay(10);
 123   1          WriteControlRegister(MPU9250_CONFIG, 0x06); //Gyro & Temp Low Pass Filter 0x01 = 184Hz, 0x02 = 92Hz, 0
             -x04 = 20Hz, 0x05 = 10Hz
 124   1          CyDelay(10);        
 125   1              WriteControlRegister(MPU9250_GYRO_CONFIG , GYRO_SF_2000); //Gyro full scale select 0x00=250Â°/s 0x80=500Â
             -°/s 0x18=2000Â°/s 
 126   1              CyDelay(10);
 127   1          WriteControlRegister(MPU9250_ACCEL_CONFIG, ACC_SF_2G); // Acc full scale select 0x00 = 2g 0x08 = 4g 0x
             -10 = 8g 0x18 = 16g
 128   1          CyDelay(10);
 129   1          WriteControlRegister(MPU9250_ACCEL_CONFIG2, 0x05);
 130   1          CyDelay(10);
 131   1              //mag register
 132   1              WriteControlRegister(MPU9250_I2C_MST_CTRL, 0x0D); //set slave I2C speed
 133   1              CyDelay(10);
 134   1              //SLV0 (use to write)
 135   1              WriteControlRegister(MPU9250_I2C_SLV0_ADDR, 0x0C); //set compass address
 136   1              CyDelay(10);                    
 137   1              WriteControlRegister(MPU9250_I2C_SLV0_REG, AK8936_CNTL); //compass mode register
 138   1              CyDelay(10);    
 139   1              WriteControlRegister(MPU9250_I2C_SLV0_D0, 0x1F); //0x1F ROM access
 140   1              CyDelay(10);
 141   1              WriteControlRegister(MPU9250_I2C_SLV0_CTRL, 0x81); //enable data from register + 1 bit to write
 142   1              CyDelay(10);
 143   1              //SLV0 (use to read)
 144   1              WriteControlRegister(MPU9250_I2C_SLV0_ADDR, 0x8C); // RCR  | AK8963_address (0x0C) 
 145   1              CyDelay(10);
 146   1              WriteControlRegister(MPU9250_I2C_SLV0_REG, 0x10); // 0x10:start from ASAX
 147   1              CyDelay(10);
 148   1              WriteControlRegister(MPU9250_I2C_SLV0_CTRL, 0x83);
 149   1              CyDelay(10);
 150   1              WriteControlRegister(MPU9250_PWR_MGMT_1, 0x00); 
 151   1              CyDelay(20);
 152   1      }
 153          
 154          /********************************************************************************
 155          * Function Name: ChipSelector                                                   *
 156          *********************************************************************************/
 157          void ChipSelector(int n)
 158          {
 159   1          Chip_Select_A_Write(15);
 160   1          Chip_Select_B_Write(3);
 161   1          
 162   1          if(n<15)
 163   1              Chip_Select_A_Write(n);
 164   1          if(n==15)
 165   1              Chip_Select_B_Write(0);
 166   1          if(n==16)
 167   1              Chip_Select_B_Write(1);
 168   1      }
 169          
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 4   

 170          /********************************************************************************
 171          * Function Name: InitIMUGeneral                                                 *
 172          *********************************************************************************/
 173          void InitIMUgeneral()
 174          {
 175   1          uint8 k_imu;
 176   1          uint8 count = 0;
 177   1          int IMU_ack;
 178   1          int tmp[N_IMU_MAX];
 179   1      
 180   1          // Initialize Memory Structure 
 181   1          memset(&g_imu, 0, sizeof(struct st_imu));
 182   1          memset(&IMU_connected, 0, sizeof(IMU_connected));
 183   1      
 184   1          // Initialize IMU to Read MagCal Parameters
 185   1          for (k_imu=0; k_imu < N_IMU_MAX; k_imu++) 
 186   1          {   
 187   2                  ChipSelector(k_imu);
 188   2                  CyDelay(10);
 189   2                  InitIMUMagCal();
 190   2                  CyDelay(10); 
 191   2          }
 192   1          
 193   1          // Reading of MagCal Parameters
 194   1          CyDelay(50);
 195   1          for (k_imu = 0; k_imu < N_IMU_MAX; k_imu++){
 196   2              ChipSelector(k_imu);
 197   2              ReadMagCal(k_imu);   
 198   2          }
 199   1      
 200   1          // First ping to be sure to wakeup IMUs
 201   1          for (k_imu=0; k_imu < N_IMU_MAX; k_imu++) 
 202   1          {   
 203   2                  ChipSelector(k_imu);
 204   2                  CyDelay(10);
 205   2                  ReadControlRegister(MPU9250_WHO_AM_I);
 206   2          }
 207   1          
 208   1          // Identify IMU connected
 209   1          ChipSelector(0);
 210   1          CyDelay(10);
 211   1          IMU_ack = ReadControlRegister(MPU9250_WHO_AM_I);
 212   1          IMU_ack = 0;
 213   1          N_IMU_Connected = 0;    
 214   1          for (k_imu = 0; k_imu < N_IMU_MAX; k_imu++) 
 215   1          {      
 216   2              ChipSelector(k_imu);
 217   2              CyDelay(10);
 218   2              IMU_ack = ReadControlRegister(MPU9250_WHO_AM_I);
 219   2              if (IMU_ack == 0x71) 
 220   2              {
 221   3                  N_IMU_Connected++;
 222   3                  IMU_ack = 0;
 223   3                  tmp[k_imu] = 1;
 224   3              }
 225   2              else
 226   2                  tmp[k_imu] = 0;
 227   2          }
 228   1      
 229   1          for(k_imu = 0; k_imu < N_IMU_MAX; k_imu++)
 230   1          {
 231   2              if(tmp[k_imu] == 1)
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 5   

 232   2              {
 233   3                  IMU_connected[count] = k_imu;
 234   3                  count++;
 235   3              }
 236   2          }
 237   1                  
 238   1          // Standard Initialization of the IMU
 239   1          Opto_Pin_Write(0);
 240   1          CyDelay(10);
 241   1          Opto_Pin_Write(1);
 242   1          CyDelay(10);
 243   1          for (k_imu=0; k_imu < N_IMU_MAX; k_imu++) 
 244   1          {   
 245   2                  ChipSelector(k_imu);
 246   2                  CyDelay(10);
 247   2                  InitIMU();
 248   2                  CyDelay(10); 
 249   2          }
 250   1          CyDelay(50);
 251   1           
 252   1          // Set Standard Read for the IMU
 253   1          memset(&single_imu_size, 0, sizeof(single_imu_size));
 254   1          imus_data_size = 1; //header    
 255   1          for (k_imu = 0; k_imu < N_IMU_Connected; k_imu++)
 256   1          {
 257   2              single_imu_size[IMU_connected[k_imu]] = 1 + 6*c_mem.IMU_conf[IMU_connected[k_imu]][0] + 6*c_mem.IM
             -U_conf[IMU_connected[k_imu]][1] + 6*c_mem.IMU_conf[IMU_connected[k_imu]][2]+ 16*c_mem.IMU_conf[IMU_connected[k_imu]][3] 
             -+ 2*c_mem.IMU_conf[IMU_connected[k_imu]][4]+ 1;
 258   2              imus_data_size = imus_data_size + single_imu_size[IMU_connected[k_imu]];
 259   2          }
 260   1          imus_data_size = imus_data_size + 1;    //checksum
 261   1      }
 262          
 263          /*******************************************************************************
 264          * Function Name: IMU Read
 265          *********************************************************************************/      
 266          void ReadIMU(int n)
 267          {
 268   1          if (c_mem.IMU_conf[n][0]) ReadAcc(n);
 269   1          if (c_mem.IMU_conf[n][1]) ReadGyro(n);
 270   1          if (c_mem.IMU_conf[n][2]) ReadMag(n);
 271   1          if (c_mem.IMU_conf[n][3]) ReadQuat(n);
 272   1          if (c_mem.IMU_conf[n][4]) ReadTemp(n);
 273   1      }
 274          
 275          /*******************************************************************************
 276          * Function Name: Read Acc's Data of IMU n
 277          *********************************************************************************/
 278          void ReadAcc(int n)
 279          {
 280   1              uint8 low=0, high=0;
 281   1              
 282   1              int row = n;
 283   1              
 284   1              //read X
 285   1          low=ReadControlRegister(MPU9250_ACCEL_XOUT_L);
 286   1          SPI_delay();
 287   1          high=ReadControlRegister(MPU9250_ACCEL_XOUT_H);
 288   1          SPI_delay();
 289   1          
 290   1              Accel[row][0] = high; 
 291   1              Accel[row][1] = low; 
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 6   

 292   1              low=0, high=0;
 293   1                              
 294   1              //read Y
 295   1          low=ReadControlRegister(MPU9250_ACCEL_YOUT_L);
 296   1          SPI_delay();
 297   1              high=ReadControlRegister(MPU9250_ACCEL_YOUT_H);
 298   1          SPI_delay();
 299   1      
 300   1              Accel[row][2] = high; 
 301   1              Accel[row][3] = low; 
 302   1              low=0, high=0;
 303   1                      
 304   1              //read Z
 305   1          low=ReadControlRegister(MPU9250_ACCEL_ZOUT_L);
 306   1          SPI_delay();
 307   1          high=ReadControlRegister(MPU9250_ACCEL_ZOUT_H);
 308   1          SPI_delay();
 309   1          
 310   1              Accel[row][4] = high; 
 311   1              Accel[row][5] = low;
 312   1              low=0, high=0;
 313   1      }
 314          
 315          /*******************************************************************************
 316          * Function Name: Read Gyro's Data of IMU n
 317          *********************************************************************************/
 318          void ReadGyro(int n){
 319   1              uint8 low=0, high=0;
 320   1          
 321   1              int row = n;
 322   1              
 323   1              //read X
 324   1              low=ReadControlRegister(MPU9250_GYRO_XOUT_L);
 325   1          SPI_delay();
 326   1              high=ReadControlRegister(MPU9250_GYRO_XOUT_H);
 327   1          SPI_delay();
 328   1          
 329   1              Gyro[row][0] = high; 
 330   1              Gyro[row][1] = low;
 331   1              low=0, high=0;
 332   1          
 333   1              //read Y
 334   1              low=ReadControlRegister(MPU9250_GYRO_YOUT_L);
 335   1          SPI_delay();
 336   1              high=ReadControlRegister(MPU9250_GYRO_YOUT_H);
 337   1          SPI_delay();
 338   1          
 339   1              Gyro[row][2] = high; 
 340   1              Gyro[row][3] = low;
 341   1              low=0, high=0;
 342   1      
 343   1              //read Z
 344   1          low=ReadControlRegister(MPU9250_GYRO_ZOUT_L);
 345   1          SPI_delay();
 346   1              high=ReadControlRegister(MPU9250_GYRO_ZOUT_H);
 347   1          SPI_delay();
 348   1          
 349   1              Gyro[row][4] = high; 
 350   1              Gyro[row][5] = low;        
 351   1      
 352   1              low=0, high=0;
 353   1      }
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 7   

 354          
 355          /*******************************************************************************
 356          * Function Name: Read Compas' Data of IMU n
 357          *********************************************************************************/
 358          void ReadMag(int n){
 359   1              
 360   1              uint8 low, high;
 361   1              int row = n;    
 362   1              //read X
 363   1              low = ReadControlRegister(MPU9250_EXT_SENS_DATA_00);
 364   1          SPI_delay();
 365   1              high = ReadControlRegister(MPU9250_EXT_SENS_DATA_01);           
 366   1          SPI_delay();
 367   1          
 368   1              Mag[row][0] = high; 
 369   1              Mag[row][1] = low;
 370   1              low=0, high=0;
 371   1          
 372   1              //read Y
 373   1              low = ReadControlRegister(MPU9250_EXT_SENS_DATA_02);
 374   1          SPI_delay();
 375   1              high = ReadControlRegister(MPU9250_EXT_SENS_DATA_03);           
 376   1          SPI_delay();
 377   1          
 378   1              Mag[row][2] = high; 
 379   1              Mag[row][3] = low;
 380   1              low=0, high=0;
 381   1          
 382   1              //read Z
 383   1              low = ReadControlRegister(MPU9250_EXT_SENS_DATA_04);
 384   1          SPI_delay();
 385   1              high = ReadControlRegister(MPU9250_EXT_SENS_DATA_05);
 386   1          SPI_delay();
 387   1                      
 388   1              Mag[row][4] = high; 
 389   1              Mag[row][5] = low;
 390   1              low=0, high=0;
 391   1      }
 392          
 393          /********************************************************************************
 394          * Function Name: ReadMagCal
 395          *********************************************************************************/
 396          void ReadMagCal(int n){
 397   1              
 398   1          uint8 read = 0; 
 399   1              int row = n;    
 400   1              //read X
 401   1              read = ReadControlRegister(MPU9250_EXT_SENS_DATA_00);
 402   1          MagCal[row][0] = read; 
 403   1          read = 0;
 404   1          
 405   1              //read Y
 406   1              read = ReadControlRegister(MPU9250_EXT_SENS_DATA_01);                   
 407   1              MagCal[row][1] = read; 
 408   1              read = 0;
 409   1          
 410   1              //read Z
 411   1              read = ReadControlRegister(MPU9250_EXT_SENS_DATA_02);                   
 412   1              MagCal[row][2] = read; 
 413   1              read = 0;
 414   1          
 415   1      }
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 8   

 416              
 417          /*******************************************************************************
 418          * Function Name: Read Quaternion of IMU n
 419          *********************************************************************************/
 420          void ReadQuat(int n)
 421          {
 422   1              uint8 i=0;      
 423   1          int16 var_h;
 424   1          float qd0,qd1,qd2,qd3;        
 425   1          float aP[3]; //, fa[3];
 426   1          float Napla[4],g[4],qL[4];
 427   1          float time = 0;
 428   1              
 429   1          if (N_IMU_Connected == 1) {
 430   2              // Compute quaternion only if 1 IMU is connected
 431   2              
 432   2              if (!c_mem.IMU_conf[n][0]) ReadAcc(n);
 433   2              if (!c_mem.IMU_conf[n][1]) ReadGyro(n);
 434   2              
 435   2              // assume cycle time is the same of last function_scheduler execution,
 436   2              // without adding another counter
 437   2              time = (float)((uint32)timer_value0 - (uint32)timer_value) / 1000000.0;
 438   2              
 439   2              // how N sees P; N is 'Earth' equivalent, P is for sensor
 440   2              // e.g. N = imu1, P = imu0, how imu1 sees imu0
 441   2      
 442   2              var_h = Accel[n][0];
 443   2              aP[0] = (int16)(var_h << 8 | Accel[n][1]); 
 444   2              var_h = Accel[n][2];
 445   2              aP[1] = (int16)(var_h << 8 | Accel[n][3]); 
 446   2              var_h = Accel[n][4];
 447   2              aP[2] = (int16)(var_h << 8 | Accel[n][5]);
 448   2              
 449   2              g[0] = 0;
 450   2              var_h = Gyro[n][0];
 451   2              g[1] = ((int16)(var_h << 8 | Gyro[n][1]))*TICK2GYRO;
 452   2              if ( fabs(g[1]) < GYRO_THR ) g[1] = 0;
 453   2              var_h = Gyro[n][2];
 454   2              g[2] = ((int16)(var_h << 8 | Gyro[n][3]))*TICK2GYRO; 
 455   2              if ( fabs(g[2]) < GYRO_THR ) g[2] = 0;
 456   2              var_h = Gyro[n][4];
 457   2              g[3] = ((int16)(var_h << 8 | Gyro[n][5]))*TICK2GYRO;
 458   2              if ( fabs(g[3]) < GYRO_THR ) g[3] = 0;
 459   2              
 460   2              // Normalize to 1
 461   2              v3_normalize(aP);
 462   2              
 463   2              // Current quaternion assignment
 464   2              qL[0] = Quat[0];
 465   2              qL[1] = Quat[1];
 466   2              qL[2] = Quat[2];
 467   2              qL[3] = Quat[3];   
 468   2              
 469   2              // Napla computation
 470   2              Napla[0] = (-qL[2]*((2*(qL[1]*qL[3]-qL[0]*qL[2]) - aP[0])) + qL[1]*((2*(qL[0]*qL[1] + qL[2]*qL[3])
             - - aP[1])))*TICK2ACC*BETA;
 471   2              Napla[1] = (qL[3]*((2*(qL[1]*qL[3]-qL[0]*qL[2]) - aP[0])) + qL[0]*((2*(qL[0]*qL[1] + qL[2]*qL[3]) 
             -- aP[1])) -2*qL[1]*((2*(0.5 - qL[1]*qL[1] - qL[2]*qL[2]) - aP[2])))*TICK2ACC*BETA;
 472   2              Napla[2] = (-qL[0]*((2*(qL[1]*qL[3]-qL[0]*qL[2]) - aP[0])) +qL[3]*((2*(qL[0]*qL[1] + qL[2]*qL[3]) 
             -- aP[1])) -2*qL[2]*((2*(0.5 - qL[1]*qL[1] - qL[2]*qL[2]) - aP[2])))*TICK2ACC*BETA;
 473   2              Napla[3] = (qL[1]*((2*(qL[1]*qL[3]-qL[0]*qL[2]) - aP[0])) + qL[2]*((2*(qL[0]*qL[1] + qL[2]*qL[3]) 
             -- aP[1])))*TICK2ACC*BETA;
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 9   

 474   2              
 475   2              qd0 = 0.5*(-(qL[1]*g[1] + qL[2]*g[2] + qL[3]*g[3])) - Napla[0];
 476   2              qd1 = 0.5*(qL[0]*g[1] + (qL[2]*g[3] - qL[3]*g[2])) - Napla[1];
 477   2              qd2 = 0.5*(qL[0]*g[2] + (qL[3]*g[1] - qL[1]*g[3])) - Napla[2];
 478   2              qd3 = 0.5*(qL[0]*g[3] + (qL[1]*g[2] - qL[2]*g[1])) - Napla[3];
 479   2                      
 480   2              qL[0] = qL[0] + qd0*time;
 481   2              qL[1] = qL[1] + qd1*time;
 482   2              qL[2] = qL[2] + qd2*time;
 483   2              qL[3] = qL[3] + qd3*time;
 484   2              v4_normalize(qL);
 485   2              
 486   2              // Quaternion update      
 487   2              Quat[0] = qL[0];
 488   2              Quat[1] = qL[1];
 489   2              Quat[2] = qL[2];
 490   2              Quat[3] = qL[3];
 491   2          }
 492   1          else {
 493   2              return;
 494   2          }
 495   1      }
 496          
 497          /********************************************************************************
 498          * Function Name: ReadAllIMUs
 499          *********************************************************************************/
 500          void ReadAllIMUs(){
 501   1          static uint8 k_imu = 0;
 502   1          uint16 tmp = 0, i = 0, j = 0;
 503   1          int16 value = 0;
 504   1      
 505   1          for (k_imu = 0; k_imu < N_IMU_Connected; k_imu++){ 
 506   2              // Read k_imu IMU
 507   2              ChipSelector(IMU_connected[k_imu]);
 508   2              ReadIMU(IMU_connected[k_imu]);
 509   2              
 510   2              for (j = 0; j < 3; j++) {
 511   3                  tmp = Accel[IMU_connected[k_imu]][2*j];
 512   3                  g_imuNew[k_imu].accel_value[j] = (int16)(tmp<<8 | Accel[IMU_connected[k_imu]][2*j + 1]);
 513   3              }
 514   2              
 515   2              for (j = 0; j < 3; j++) {
 516   3                  tmp = Gyro[IMU_connected[k_imu]][2*j];
 517   3                  g_imuNew[k_imu].gyro_value[j] = (int16)(tmp<<8 | Gyro[IMU_connected[k_imu]][2*j + 1]);
 518   3              }
 519   2                      
 520   2              for (j = 0; j < 3; j++) {
 521   3                  tmp = Mag[IMU_connected[k_imu]][2*j];
 522   3                  g_imuNew[k_imu].mag_value[j] = (int16)(tmp<<8 | Mag[IMU_connected[k_imu]][2*j + 1]);
 523   3              }  
 524   2              
 525   2              // Save quaternion only for first IMU
 526   2              for (j = 0; k_imu == 0 && j < 4; j++) {
 527   3                  g_imuNew[k_imu].quat_value[j] = (float)Quat[j];
 528   3              }
 529   2              
 530   2              tmp = Temp[IMU_connected[k_imu]][0];
 531   2              g_imuNew[k_imu].temp_value = (int16)(tmp<<8 | Temp[IMU_connected[k_imu]][1]);
 532   2          }
 533   1      }
 534          
 535          /*******************************************************************************
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 10  

 536          * Function Name: Read Temperature Data of IMU n
 537          *********************************************************************************/
 538          void ReadTemp(int n)
 539          {
 540   1              uint8 low=0, high=0;    
 541   1              int row = n;
 542   1              
 543   1              //read X
 544   1          low=ReadControlRegister(MPU9250_TEMP_OUT_L);
 545   1          SPI_delay();
 546   1              high=ReadControlRegister(MPU9250_TEMP_OUT_H);
 547   1          SPI_delay();
 548   1      
 549   1              Temp[row][0] = high; 
 550   1              Temp[row][1] = low; 
 551   1              low=0, high=0;
 552   1      }
 553          
 554          /********************************** *********************************************
 555          * Function Name: Write Control Register
 556          *********************************************************************************/
 557          void WriteControlRegister(uint8 address, uint8 dta){
 558   1              
 559   1              SPI_IMU_ClearRxBuffer();
 560   1              SPI_IMU_ClearTxBuffer();
 561   1              SPI_IMU_ClearFIFO();
 562   1              SPI_IMU_WriteByte(MPU9250_WCR | address);
 563   1              while(!( SPI_IMU_ReadStatus() & SPI_IMU_STS_TX_FIFO_EMPTY));            
 564   1              SPI_IMU_WriteByte(dta);
 565   1              while(!( SPI_IMU_ReadStatus() & SPI_IMU_STS_TX_FIFO_EMPTY));
 566   1      }
 567          
 568          /*******************************************************************************
 569          * Function Name: Read Control Register
 570          *********************************************************************************/
 571          uint8 ReadControlRegister(uint8 address){
 572   1              uint8 controlreg;
 573   1              
 574   1              SPI_IMU_WriteByte(MPU9250_RCR | address);
 575   1          SPI_IMU_WriteByte(0x00);
 576   1              while(!( SPI_IMU_ReadStatus() & SPI_IMU_STS_SPI_DONE));
 577   1              controlreg = SPI_IMU_ReadByte();        //real data
 578   1              return controlreg;
 579   1      }
 580          
 581          /*******************************************************************************
 582          * Function Name: SPI delay
 583          *********************************************************************************/
 584          void SPI_delay(){
 585   1          switch( c_mem.SPI_read_delay ) {
 586   2              case 1:     // Low
 587   2                  CyDelayUs((uint16)SPI_DELAY_LOW);
 588   2                  break;
 589   2              case 2:     // High
 590   2                  CyDelayUs((uint16)SPI_DELAY_HIGH);
 591   2                  break;
 592   2              default:    // None
 593   2                  break;
 594   2          }
 595   1      }
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 11  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION ImusReset (BEGIN)
                                           ; SOURCE LINE # 56
                                           ; SOURCE LINE # 58
0000 7F00              MOV     R7,#00H
0002 120000      E     LCALL   _Opto_Pin_Write
                                           ; SOURCE LINE # 59
0005 7F0A              MOV     R7,#0AH
0007 7E00              MOV     R6,#00H
0009 7D00              MOV     R5,#00H
000B 7C00              MOV     R4,#00H
000D 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 60
0010 7F01              MOV     R7,#01H
0012 120000      E     LCALL   _Opto_Pin_Write
                                           ; SOURCE LINE # 61
0015 7F0A              MOV     R7,#0AH
0017 7E00              MOV     R6,#00H
0019 7D00              MOV     R5,#00H
001B 7C00              MOV     R4,#00H
001D 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 62
0020 120000      R     LCALL   InitIMUgeneral
                                           ; SOURCE LINE # 64
0023 7F0A              MOV     R7,#0AH
0025 7E00              MOV     R6,#00H
0027 7D00              MOV     R5,#00H
0029 7C00              MOV     R4,#00H
002B 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 65
002E 22                RET     
             ; FUNCTION ImusReset (END)

             ; FUNCTION InitIMU (BEGIN)
                                           ; SOURCE LINE # 70
                                           ; SOURCE LINE # 72
0000 7D10              MOV     R5,#010H
0002 7F6B              MOV     R7,#06BH
0004 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 73
0007 7F0A              MOV     R7,#0AH
0009 7E00              MOV     R6,#00H
000B 7D00              MOV     R5,#00H
000D 7C00              MOV     R4,#00H
000F 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 74
0012 7D20              MOV     R5,#020H
0014 7F6A              MOV     R7,#06AH
0016 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 75
0019 7F0A              MOV     R7,#0AH
001B 7E00              MOV     R6,#00H
001D 7D00              MOV     R5,#00H
001F 7C00              MOV     R4,#00H
0021 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 76
0024 7D06              MOV     R5,#06H
0026 7F1A              MOV     R7,#01AH
0028 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 77
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 12  

002B 7F0A              MOV     R7,#0AH
002D 7E00              MOV     R6,#00H
002F 7D00              MOV     R5,#00H
0031 7C00              MOV     R4,#00H
0033 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 78
0036 7D18              MOV     R5,#018H
0038 7F1B              MOV     R7,#01BH
003A 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 79
003D 7F0A              MOV     R7,#0AH
003F 7E00              MOV     R6,#00H
0041 7D00              MOV     R5,#00H
0043 7C00              MOV     R4,#00H
0045 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 80
0048 7D00              MOV     R5,#00H
004A 7F1C              MOV     R7,#01CH
004C 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 81
004F 7F0A              MOV     R7,#0AH
0051 7E00              MOV     R6,#00H
0053 7D00              MOV     R5,#00H
0055 7C00              MOV     R4,#00H
0057 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 85
005A 7D05              MOV     R5,#05H
005C 7F1D              MOV     R7,#01DH
005E 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 87
0061 7F0A              MOV     R7,#0AH
0063 7E00              MOV     R6,#00H
0065 7D00              MOV     R5,#00H
0067 7C00              MOV     R4,#00H
0069 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 89
006C 7D0D              MOV     R5,#0DH
006E 7F24              MOV     R7,#024H
0070 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 90
0073 7F0A              MOV     R7,#0AH
0075 7E00              MOV     R6,#00H
0077 7D00              MOV     R5,#00H
0079 7C00              MOV     R4,#00H
007B 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 92
007E 7D0C              MOV     R5,#0CH
0080 7F25              MOV     R7,#025H
0082 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 93
0085 7F0A              MOV     R7,#0AH
0087 7E00              MOV     R6,#00H
0089 7D00              MOV     R5,#00H
008B 7C00              MOV     R4,#00H
008D 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 94
0090 7D0A              MOV     R5,#0AH
0092 7F26              MOV     R7,#026H
0094 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 95
0097 7F0A              MOV     R7,#0AH
0099 7E00              MOV     R6,#00H
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 13  

009B 7D00              MOV     R5,#00H
009D 7C00              MOV     R4,#00H
009F 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 97
00A2 7D16              MOV     R5,#016H
00A4 7F63              MOV     R7,#063H
00A6 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 98
00A9 7F0A              MOV     R7,#0AH
00AB 7E00              MOV     R6,#00H
00AD 7D00              MOV     R5,#00H
00AF 7C00              MOV     R4,#00H
00B1 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 99
00B4 7D81              MOV     R5,#081H
00B6 7F27              MOV     R7,#027H
00B8 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 100
00BB 7F0A              MOV     R7,#0AH
00BD 7E00              MOV     R6,#00H
00BF 7D00              MOV     R5,#00H
00C1 7C00              MOV     R4,#00H
00C3 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 102
00C6 7D8C              MOV     R5,#08CH
00C8 7F25              MOV     R7,#025H
00CA 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 103
00CD 7F0A              MOV     R7,#0AH
00CF 7E00              MOV     R6,#00H
00D1 7D00              MOV     R5,#00H
00D3 7C00              MOV     R4,#00H
00D5 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 105
00D8 7D03              MOV     R5,#03H
00DA 7F26              MOV     R7,#026H
00DC 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 106
00DF 7F0A              MOV     R7,#0AH
00E1 7E00              MOV     R6,#00H
00E3 7D00              MOV     R5,#00H
00E5 7C00              MOV     R4,#00H
00E7 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 108
00EA 7D8D              MOV     R5,#08DH
00EC 7F27              MOV     R7,#027H
00EE 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 109
00F1 7F0A              MOV     R7,#0AH
00F3 7E00              MOV     R6,#00H
00F5 7D00              MOV     R5,#00H
00F7 7C00              MOV     R4,#00H
00F9 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 110
00FC 7D00              MOV     R5,#00H
00FE 7F6B              MOV     R7,#06BH
0100 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 111
0103 7F14              MOV     R7,#014H
0105 7E00              MOV     R6,#00H
0107 7D00              MOV     R5,#00H
0109 7C00              MOV     R4,#00H
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 14  

010B 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 112
010E 22                RET     
             ; FUNCTION InitIMU (END)

             ; FUNCTION InitIMUMagCal (BEGIN)
                                           ; SOURCE LINE # 117
                                           ; SOURCE LINE # 119
0000 7D10              MOV     R5,#010H
0002 7F6B              MOV     R7,#06BH
0004 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 120
0007 7F0A              MOV     R7,#0AH
0009 7E00              MOV     R6,#00H
000B 7D00              MOV     R5,#00H
000D 7C00              MOV     R4,#00H
000F 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 121
0012 7D20              MOV     R5,#020H
0014 7F6A              MOV     R7,#06AH
0016 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 122
0019 7F0A              MOV     R7,#0AH
001B 7E00              MOV     R6,#00H
001D 7D00              MOV     R5,#00H
001F 7C00              MOV     R4,#00H
0021 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 123
0024 7D06              MOV     R5,#06H
0026 7F1A              MOV     R7,#01AH
0028 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 124
002B 7F0A              MOV     R7,#0AH
002D 7E00              MOV     R6,#00H
002F 7D00              MOV     R5,#00H
0031 7C00              MOV     R4,#00H
0033 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 125
0036 7D18              MOV     R5,#018H
0038 7F1B              MOV     R7,#01BH
003A 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 126
003D 7F0A              MOV     R7,#0AH
003F 7E00              MOV     R6,#00H
0041 7D00              MOV     R5,#00H
0043 7C00              MOV     R4,#00H
0045 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 127
0048 7D00              MOV     R5,#00H
004A 7F1C              MOV     R7,#01CH
004C 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 128
004F 7F0A              MOV     R7,#0AH
0051 7E00              MOV     R6,#00H
0053 7D00              MOV     R5,#00H
0055 7C00              MOV     R4,#00H
0057 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 129
005A 7D05              MOV     R5,#05H
005C 7F1D              MOV     R7,#01DH
005E 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 130
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 15  

0061 7F0A              MOV     R7,#0AH
0063 7E00              MOV     R6,#00H
0065 7D00              MOV     R5,#00H
0067 7C00              MOV     R4,#00H
0069 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 132
006C 7D0D              MOV     R5,#0DH
006E 7F24              MOV     R7,#024H
0070 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 133
0073 7F0A              MOV     R7,#0AH
0075 7E00              MOV     R6,#00H
0077 7D00              MOV     R5,#00H
0079 7C00              MOV     R4,#00H
007B 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 135
007E 7D0C              MOV     R5,#0CH
0080 7F25              MOV     R7,#025H
0082 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 136
0085 7F0A              MOV     R7,#0AH
0087 7E00              MOV     R6,#00H
0089 7D00              MOV     R5,#00H
008B 7C00              MOV     R4,#00H
008D 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 137
0090 7D0A              MOV     R5,#0AH
0092 7F26              MOV     R7,#026H
0094 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 138
0097 7F0A              MOV     R7,#0AH
0099 7E00              MOV     R6,#00H
009B 7D00              MOV     R5,#00H
009D 7C00              MOV     R4,#00H
009F 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 139
00A2 7D1F              MOV     R5,#01FH
00A4 7F63              MOV     R7,#063H
00A6 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 140
00A9 7F0A              MOV     R7,#0AH
00AB 7E00              MOV     R6,#00H
00AD 7D00              MOV     R5,#00H
00AF 7C00              MOV     R4,#00H
00B1 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 141
00B4 7D81              MOV     R5,#081H
00B6 7F27              MOV     R7,#027H
00B8 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 142
00BB 7F0A              MOV     R7,#0AH
00BD 7E00              MOV     R6,#00H
00BF 7D00              MOV     R5,#00H
00C1 7C00              MOV     R4,#00H
00C3 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 144
00C6 7D8C              MOV     R5,#08CH
00C8 7F25              MOV     R7,#025H
00CA 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 145
00CD 7F0A              MOV     R7,#0AH
00CF 7E00              MOV     R6,#00H
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 16  

00D1 7D00              MOV     R5,#00H
00D3 7C00              MOV     R4,#00H
00D5 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 146
00D8 7D10              MOV     R5,#010H
00DA 7F26              MOV     R7,#026H
00DC 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 147
00DF 7F0A              MOV     R7,#0AH
00E1 7E00              MOV     R6,#00H
00E3 7D00              MOV     R5,#00H
00E5 7C00              MOV     R4,#00H
00E7 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 148
00EA 7D83              MOV     R5,#083H
00EC 7F27              MOV     R7,#027H
00EE 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 149
00F1 7F0A              MOV     R7,#0AH
00F3 7E00              MOV     R6,#00H
00F5 7D00              MOV     R5,#00H
00F7 7C00              MOV     R4,#00H
00F9 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 150
00FC 7D00              MOV     R5,#00H
00FE 7F6B              MOV     R7,#06BH
0100 120000      R     LCALL   _WriteControlRegister
                                           ; SOURCE LINE # 151
0103 7F14              MOV     R7,#014H
0105 7E00              MOV     R6,#00H
0107 7D00              MOV     R5,#00H
0109 7C00              MOV     R4,#00H
010B 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 152
010E 22                RET     
             ; FUNCTION InitIMUMagCal (END)

             ; FUNCTION _ChipSelector (BEGIN)
                                           ; SOURCE LINE # 157
0000 900000      R     MOV     DPTR,#n
0003 EE                MOV     A,R6
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 EF                MOV     A,R7
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 158
                                           ; SOURCE LINE # 159
0008 7F0F              MOV     R7,#0FH
000A 120000      E     LCALL   _Chip_Select_A_Write
                                           ; SOURCE LINE # 160
000D 7F03              MOV     R7,#03H
000F 120000      E     LCALL   _Chip_Select_B_Write
                                           ; SOURCE LINE # 162
0012 900000      R     MOV     DPTR,#n
0015 E0                MOVX    A,@DPTR
0016 FE                MOV     R6,A
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 FF                MOV     R7,A
001A C3                CLR     C
001B EF                MOV     A,R7
001C 940F              SUBB    A,#0FH
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 17  

001E EE                MOV     A,R6
001F 6480              XRL     A,#080H
0021 9480              SUBB    A,#080H
0023 500B              JNC     ?C0004
                                           ; SOURCE LINE # 163
0025 900000      R     MOV     DPTR,#n
0028 E0                MOVX    A,@DPTR
0029 FE                MOV     R6,A
002A A3                INC     DPTR
002B E0                MOVX    A,@DPTR
002C FF                MOV     R7,A
002D 120000      E     LCALL   _Chip_Select_A_Write
0030         ?C0004:
                                           ; SOURCE LINE # 164
0030 900000      R     MOV     DPTR,#n
0033 E0                MOVX    A,@DPTR
0034 FE                MOV     R6,A
0035 A3                INC     DPTR
0036 E0                MOVX    A,@DPTR
0037 FF                MOV     R7,A
0038 EF                MOV     A,R7
0039 640F              XRL     A,#0FH
003B 4E                ORL     A,R6
003C 7005              JNZ     ?C0005
                                           ; SOURCE LINE # 165
003E 7F00              MOV     R7,#00H
0040 120000      E     LCALL   _Chip_Select_B_Write
0043         ?C0005:
                                           ; SOURCE LINE # 166
0043 900000      R     MOV     DPTR,#n
0046 E0                MOVX    A,@DPTR
0047 FE                MOV     R6,A
0048 A3                INC     DPTR
0049 E0                MOVX    A,@DPTR
004A FF                MOV     R7,A
004B EF                MOV     A,R7
004C 6410              XRL     A,#010H
004E 4E                ORL     A,R6
004F 7005              JNZ     ?C0007
                                           ; SOURCE LINE # 167
0051 7F01              MOV     R7,#01H
0053 120000      E     LCALL   _Chip_Select_B_Write
                                           ; SOURCE LINE # 168
0056         ?C0007:
0056 22                RET     
             ; FUNCTION _ChipSelector (END)

             ; FUNCTION InitIMUgeneral (BEGIN)
                                           ; SOURCE LINE # 173
                                           ; SOURCE LINE # 174
                                           ; SOURCE LINE # 176
0000 900000      R     MOV     DPTR,#count
0003 E4                CLR     A
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 181
0005 7E00              MOV     R6,#00H
0007 7F25              MOV     R7,#025H
0009 7D00              MOV     R5,#00H
000B 7B01              MOV     R3,#01H
000D 7A00        E     MOV     R2,#HIGH g_imu
000F 7900        E     MOV     R1,#LOW g_imu
0011 120000      E     LCALL   ?C?MEMSET
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 18  

                                           ; SOURCE LINE # 182
0014 7E00              MOV     R6,#00H
0016 7F11              MOV     R7,#011H
0018 7D00              MOV     R5,#00H
001A 7B01              MOV     R3,#01H
001C 7A00        E     MOV     R2,#HIGH IMU_connected
001E 7900        E     MOV     R1,#LOW IMU_connected
0020 120000      E     LCALL   ?C?MEMSET
                                           ; SOURCE LINE # 185
0023 900000      R     MOV     DPTR,#k_imu
0026 E4                CLR     A
0027 F0                MOVX    @DPTR,A
0028         ?C0008:
0028 900000      R     MOV     DPTR,#k_imu
002B E0                MOVX    A,@DPTR
002C FF                MOV     R7,A
002D EF                MOV     A,R7
002E C3                CLR     C
002F 9411              SUBB    A,#011H
0031 502B              JNC     ?C0009
                                           ; SOURCE LINE # 186
                                           ; SOURCE LINE # 187
0033 900000      R     MOV     DPTR,#k_imu
0036 E0                MOVX    A,@DPTR
0037 FF                MOV     R7,A
0038 7E00              MOV     R6,#00H
003A 120000      R     LCALL   _ChipSelector
                                           ; SOURCE LINE # 188
003D 7F0A              MOV     R7,#0AH
003F 7E00              MOV     R6,#00H
0041 7D00              MOV     R5,#00H
0043 7C00              MOV     R4,#00H
0045 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 189
0048 120000      R     LCALL   InitIMUMagCal
                                           ; SOURCE LINE # 190
004B 7F0A              MOV     R7,#0AH
004D 7E00              MOV     R6,#00H
004F 7D00              MOV     R5,#00H
0051 7C00              MOV     R4,#00H
0053 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 191
0056 900000      R     MOV     DPTR,#k_imu
0059 E0                MOVX    A,@DPTR
005A 04                INC     A
005B F0                MOVX    @DPTR,A
005C 80CA              SJMP    ?C0008
005E         ?C0009:
                                           ; SOURCE LINE # 194
005E 7F32              MOV     R7,#032H
0060 7E00              MOV     R6,#00H
0062 7D00              MOV     R5,#00H
0064 7C00              MOV     R4,#00H
0066 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 195
0069 900000      R     MOV     DPTR,#k_imu
006C E4                CLR     A
006D F0                MOVX    @DPTR,A
006E         ?C0011:
006E 900000      R     MOV     DPTR,#k_imu
0071 E0                MOVX    A,@DPTR
0072 FF                MOV     R7,A
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 19  

0073 EF                MOV     A,R7
0074 C3                CLR     C
0075 9411              SUBB    A,#011H
0077 501C              JNC     ?C0012
                                           ; SOURCE LINE # 196
0079 900000      R     MOV     DPTR,#k_imu
007C E0                MOVX    A,@DPTR
007D FF                MOV     R7,A
007E 7E00              MOV     R6,#00H
0080 120000      R     LCALL   _ChipSelector
                                           ; SOURCE LINE # 197
0083 900000      R     MOV     DPTR,#k_imu
0086 E0                MOVX    A,@DPTR
0087 FF                MOV     R7,A
0088 7E00              MOV     R6,#00H
008A 120000      R     LCALL   _ReadMagCal
                                           ; SOURCE LINE # 198
008D 900000      R     MOV     DPTR,#k_imu
0090 E0                MOVX    A,@DPTR
0091 04                INC     A
0092 F0                MOVX    @DPTR,A
0093 80D9              SJMP    ?C0011
0095         ?C0012:
                                           ; SOURCE LINE # 201
0095 900000      R     MOV     DPTR,#k_imu
0098 E4                CLR     A
0099 F0                MOVX    @DPTR,A
009A         ?C0014:
009A 900000      R     MOV     DPTR,#k_imu
009D E0                MOVX    A,@DPTR
009E FF                MOV     R7,A
009F EF                MOV     A,R7
00A0 C3                CLR     C
00A1 9411              SUBB    A,#011H
00A3 5022              JNC     ?C0015
                                           ; SOURCE LINE # 202
                                           ; SOURCE LINE # 203
00A5 900000      R     MOV     DPTR,#k_imu
00A8 E0                MOVX    A,@DPTR
00A9 FF                MOV     R7,A
00AA 7E00              MOV     R6,#00H
00AC 120000      R     LCALL   _ChipSelector
                                           ; SOURCE LINE # 204
00AF 7F0A              MOV     R7,#0AH
00B1 7E00              MOV     R6,#00H
00B3 7D00              MOV     R5,#00H
00B5 7C00              MOV     R4,#00H
00B7 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 205
00BA 7F75              MOV     R7,#075H
00BC 120000      R     LCALL   _ReadControlRegister
                                           ; SOURCE LINE # 206
00BF 900000      R     MOV     DPTR,#k_imu
00C2 E0                MOVX    A,@DPTR
00C3 04                INC     A
00C4 F0                MOVX    @DPTR,A
00C5 80D3              SJMP    ?C0014
00C7         ?C0015:
                                           ; SOURCE LINE # 209
00C7 7F00              MOV     R7,#00H
00C9 7E00              MOV     R6,#00H
00CB 120000      R     LCALL   _ChipSelector
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 20  

                                           ; SOURCE LINE # 210
00CE 7F0A              MOV     R7,#0AH
00D0 7E00              MOV     R6,#00H
00D2 7D00              MOV     R5,#00H
00D4 7C00              MOV     R4,#00H
00D6 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 211
00D9 7F75              MOV     R7,#075H
00DB 120000      R     LCALL   _ReadControlRegister
00DE 7E00              MOV     R6,#00H
00E0 900000      R     MOV     DPTR,#IMU_ack
00E3 EE                MOV     A,R6
00E4 F0                MOVX    @DPTR,A
00E5 A3                INC     DPTR
00E6 EF                MOV     A,R7
00E7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 212
00E8 900000      R     MOV     DPTR,#IMU_ack
00EB E4                CLR     A
00EC F0                MOVX    @DPTR,A
00ED A3                INC     DPTR
00EE E4                CLR     A
00EF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 213
00F0 900000      E     MOV     DPTR,#N_IMU_Connected
00F3 E4                CLR     A
00F4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 214
00F5 900000      R     MOV     DPTR,#k_imu
00F8 E4                CLR     A
00F9 F0                MOVX    @DPTR,A
00FA         ?C0017:
00FA 900000      R     MOV     DPTR,#k_imu
00FD E0                MOVX    A,@DPTR
00FE FF                MOV     R7,A
00FF EF                MOV     A,R7
0100 C3                CLR     C
0101 9411              SUBB    A,#011H
0103 5078              JNC     ?C0018
                                           ; SOURCE LINE # 215
                                           ; SOURCE LINE # 216
0105 900000      R     MOV     DPTR,#k_imu
0108 E0                MOVX    A,@DPTR
0109 FF                MOV     R7,A
010A 7E00              MOV     R6,#00H
010C 120000      R     LCALL   _ChipSelector
                                           ; SOURCE LINE # 217
010F 7F0A              MOV     R7,#0AH
0111 7E00              MOV     R6,#00H
0113 7D00              MOV     R5,#00H
0115 7C00              MOV     R4,#00H
0117 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 218
011A 7F75              MOV     R7,#075H
011C 120000      R     LCALL   _ReadControlRegister
011F 7E00              MOV     R6,#00H
0121 900000      R     MOV     DPTR,#IMU_ack
0124 EE                MOV     A,R6
0125 F0                MOVX    @DPTR,A
0126 A3                INC     DPTR
0127 EF                MOV     A,R7
0128 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 21  

                                           ; SOURCE LINE # 219
0129 900000      R     MOV     DPTR,#IMU_ack
012C E0                MOVX    A,@DPTR
012D FE                MOV     R6,A
012E A3                INC     DPTR
012F E0                MOVX    A,@DPTR
0130 FF                MOV     R7,A
0131 EF                MOV     A,R7
0132 6471              XRL     A,#071H
0134 4E                ORL     A,R6
0135 7027              JNZ     ?C0020
                                           ; SOURCE LINE # 220
                                           ; SOURCE LINE # 221
0137 900000      E     MOV     DPTR,#N_IMU_Connected
013A E0                MOVX    A,@DPTR
013B 04                INC     A
013C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 222
013D 900000      R     MOV     DPTR,#IMU_ack
0140 E4                CLR     A
0141 F0                MOVX    @DPTR,A
0142 A3                INC     DPTR
0143 E4                CLR     A
0144 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 223
0145 900000      R     MOV     DPTR,#k_imu
0148 E0                MOVX    A,@DPTR
0149 FF                MOV     R7,A
014A EF                MOV     A,R7
014B 25E0              ADD     A,ACC
014D 2400        R     ADD     A,#LOW tmp
014F F582              MOV     DPL,A
0151 E4                CLR     A
0152 3400        R     ADDC    A,#HIGH tmp
0154 F583              MOV     DPH,A
0156 E4                CLR     A
0157 F0                MOVX    @DPTR,A
0158 A3                INC     DPTR
0159 7401              MOV     A,#01H
015B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 224
015C 8016              SJMP    ?C0019
015E         ?C0020:
                                           ; SOURCE LINE # 226
015E 900000      R     MOV     DPTR,#k_imu
0161 E0                MOVX    A,@DPTR
0162 FF                MOV     R7,A
0163 EF                MOV     A,R7
0164 25E0              ADD     A,ACC
0166 2400        R     ADD     A,#LOW tmp
0168 F582              MOV     DPL,A
016A E4                CLR     A
016B 3400        R     ADDC    A,#HIGH tmp
016D F583              MOV     DPH,A
016F E4                CLR     A
0170 F0                MOVX    @DPTR,A
0171 A3                INC     DPTR
0172 E4                CLR     A
0173 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 227
0174         ?C0019:
0174 900000      R     MOV     DPTR,#k_imu
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 22  

0177 E0                MOVX    A,@DPTR
0178 04                INC     A
0179 F0                MOVX    @DPTR,A
017A 020000      R     LJMP    ?C0017
017D         ?C0018:
                                           ; SOURCE LINE # 229
017D 900000      R     MOV     DPTR,#k_imu
0180 E4                CLR     A
0181 F0                MOVX    @DPTR,A
0182         ?C0022:
0182 900000      R     MOV     DPTR,#k_imu
0185 E0                MOVX    A,@DPTR
0186 FF                MOV     R7,A
0187 EF                MOV     A,R7
0188 C3                CLR     C
0189 9411              SUBB    A,#011H
018B 5040              JNC     ?C0023
                                           ; SOURCE LINE # 230
                                           ; SOURCE LINE # 231
018D 900000      R     MOV     DPTR,#k_imu
0190 E0                MOVX    A,@DPTR
0191 FF                MOV     R7,A
0192 EF                MOV     A,R7
0193 25E0              ADD     A,ACC
0195 2400        R     ADD     A,#LOW tmp
0197 F582              MOV     DPL,A
0199 E4                CLR     A
019A 3400        R     ADDC    A,#HIGH tmp
019C F583              MOV     DPH,A
019E E0                MOVX    A,@DPTR
019F FE                MOV     R6,A
01A0 A3                INC     DPTR
01A1 E0                MOVX    A,@DPTR
01A2 FF                MOV     R7,A
01A3 EF                MOV     A,R7
01A4 6401              XRL     A,#01H
01A6 4E                ORL     A,R6
01A7 701C              JNZ     ?C0024
                                           ; SOURCE LINE # 232
                                           ; SOURCE LINE # 233
01A9 900000      R     MOV     DPTR,#k_imu
01AC E0                MOVX    A,@DPTR
01AD FF                MOV     R7,A
01AE 900000      R     MOV     DPTR,#count
01B1 E0                MOVX    A,@DPTR
01B2 FE                MOV     R6,A
01B3 7400        E     MOV     A,#LOW IMU_connected
01B5 2E                ADD     A,R6
01B6 F582              MOV     DPL,A
01B8 E4                CLR     A
01B9 3400        E     ADDC    A,#HIGH IMU_connected
01BB F583              MOV     DPH,A
01BD EF                MOV     A,R7
01BE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 234
01BF 900000      R     MOV     DPTR,#count
01C2 E0                MOVX    A,@DPTR
01C3 04                INC     A
01C4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 235
                                           ; SOURCE LINE # 236
01C5         ?C0024:
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 23  

01C5 900000      R     MOV     DPTR,#k_imu
01C8 E0                MOVX    A,@DPTR
01C9 04                INC     A
01CA F0                MOVX    @DPTR,A
01CB 80B5              SJMP    ?C0022
01CD         ?C0023:
                                           ; SOURCE LINE # 239
01CD 7F00              MOV     R7,#00H
01CF 120000      E     LCALL   _Opto_Pin_Write
                                           ; SOURCE LINE # 240
01D2 7F0A              MOV     R7,#0AH
01D4 7E00              MOV     R6,#00H
01D6 7D00              MOV     R5,#00H
01D8 7C00              MOV     R4,#00H
01DA 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 241
01DD 7F01              MOV     R7,#01H
01DF 120000      E     LCALL   _Opto_Pin_Write
                                           ; SOURCE LINE # 242
01E2 7F0A              MOV     R7,#0AH
01E4 7E00              MOV     R6,#00H
01E6 7D00              MOV     R5,#00H
01E8 7C00              MOV     R4,#00H
01EA 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 243
01ED 900000      R     MOV     DPTR,#k_imu
01F0 E4                CLR     A
01F1 F0                MOVX    @DPTR,A
01F2         ?C0026:
01F2 900000      R     MOV     DPTR,#k_imu
01F5 E0                MOVX    A,@DPTR
01F6 FF                MOV     R7,A
01F7 EF                MOV     A,R7
01F8 C3                CLR     C
01F9 9411              SUBB    A,#011H
01FB 502B              JNC     ?C0027
                                           ; SOURCE LINE # 244
                                           ; SOURCE LINE # 245
01FD 900000      R     MOV     DPTR,#k_imu
0200 E0                MOVX    A,@DPTR
0201 FF                MOV     R7,A
0202 7E00              MOV     R6,#00H
0204 120000      R     LCALL   _ChipSelector
                                           ; SOURCE LINE # 246
0207 7F0A              MOV     R7,#0AH
0209 7E00              MOV     R6,#00H
020B 7D00              MOV     R5,#00H
020D 7C00              MOV     R4,#00H
020F 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 247
0212 120000      R     LCALL   InitIMU
                                           ; SOURCE LINE # 248
0215 7F0A              MOV     R7,#0AH
0217 7E00              MOV     R6,#00H
0219 7D00              MOV     R5,#00H
021B 7C00              MOV     R4,#00H
021D 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 249
0220 900000      R     MOV     DPTR,#k_imu
0223 E0                MOVX    A,@DPTR
0224 04                INC     A
0225 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 24  

0226 80CA              SJMP    ?C0026
0228         ?C0027:
                                           ; SOURCE LINE # 250
0228 7F32              MOV     R7,#032H
022A 7E00              MOV     R6,#00H
022C 7D00              MOV     R5,#00H
022E 7C00              MOV     R4,#00H
0230 120000      E     LCALL   _?CyDelay
                                           ; SOURCE LINE # 253
0233 7E00              MOV     R6,#00H
0235 7F22              MOV     R7,#022H
0237 7D00              MOV     R5,#00H
0239 7B01              MOV     R3,#01H
023B 7A00        E     MOV     R2,#HIGH single_imu_size
023D 7900        E     MOV     R1,#LOW single_imu_size
023F 120000      E     LCALL   ?C?MEMSET
                                           ; SOURCE LINE # 254
0242 900000      E     MOV     DPTR,#imus_data_size
0245 E4                CLR     A
0246 F0                MOVX    @DPTR,A
0247 A3                INC     DPTR
0248 7401              MOV     A,#01H
024A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 255
024B 900000      R     MOV     DPTR,#k_imu
024E E4                CLR     A
024F F0                MOVX    @DPTR,A
0250         ?C0029:
0250 900000      E     MOV     DPTR,#N_IMU_Connected
0253 E0                MOVX    A,@DPTR
0254 FF                MOV     R7,A
0255 900000      R     MOV     DPTR,#k_imu
0258 E0                MOVX    A,@DPTR
0259 FE                MOV     R6,A
025A EE                MOV     A,R6
025B C3                CLR     C
025C 9F                SUBB    A,R7
025D 4003              JC      $ + 5H
025F 020000      R     LJMP    ?C0030
                                           ; SOURCE LINE # 256
                                           ; SOURCE LINE # 257
0262 900000      R     MOV     DPTR,#k_imu
0265 E0                MOVX    A,@DPTR
0266 FF                MOV     R7,A
0267 7400        E     MOV     A,#LOW IMU_connected
0269 2F                ADD     A,R7
026A F582              MOV     DPL,A
026C E4                CLR     A
026D 3400        E     ADDC    A,#HIGH IMU_connected
026F F583              MOV     DPH,A
0271 E0                MOVX    A,@DPTR
0272 FF                MOV     R7,A
0273 EF                MOV     A,R7
0274 75F005            MOV     B,#05H
0277 A4                MUL     AB
0278 2400        E     ADD     A,#LOW c_mem+05H
027A F582              MOV     DPL,A
027C E4                CLR     A
027D 3400        E     ADDC    A,#HIGH c_mem+05H
027F F583              MOV     DPH,A
0281 E0                MOVX    A,@DPTR
0282 FF                MOV     R7,A
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 25  

0283 EF                MOV     A,R7
0284 75F006            MOV     B,#06H
0287 A4                MUL     AB
0288 FF                MOV     R7,A
0289 900000      R     MOV     DPTR,#k_imu
028C E0                MOVX    A,@DPTR
028D FE                MOV     R6,A
028E 7400        E     MOV     A,#LOW IMU_connected
0290 2E                ADD     A,R6
0291 F582              MOV     DPL,A
0293 E4                CLR     A
0294 3400        E     ADDC    A,#HIGH IMU_connected
0296 F583              MOV     DPH,A
0298 E0                MOVX    A,@DPTR
0299 FE                MOV     R6,A
029A EE                MOV     A,R6
029B 75F005            MOV     B,#05H
029E A4                MUL     AB
029F 2400        E     ADD     A,#LOW c_mem+04H
02A1 F582              MOV     DPL,A
02A3 E4                CLR     A
02A4 3400        E     ADDC    A,#HIGH c_mem+04H
02A6 F583              MOV     DPH,A
02A8 E0                MOVX    A,@DPTR
02A9 FE                MOV     R6,A
02AA EE                MOV     A,R6
02AB 75F006            MOV     B,#06H
02AE A4                MUL     AB
02AF FE                MOV     R6,A
02B0 EE                MOV     A,R6
02B1 2F                ADD     A,R7
02B2 FF                MOV     R7,A
02B3 900000      R     MOV     DPTR,#k_imu
02B6 E0                MOVX    A,@DPTR
02B7 FE                MOV     R6,A
02B8 7400        E     MOV     A,#LOW IMU_connected
02BA 2E                ADD     A,R6
02BB F582              MOV     DPL,A
02BD E4                CLR     A
02BE 3400        E     ADDC    A,#HIGH IMU_connected
02C0 F583              MOV     DPH,A
02C2 E0                MOVX    A,@DPTR
02C3 FE                MOV     R6,A
02C4 EE                MOV     A,R6
02C5 75F005            MOV     B,#05H
02C8 A4                MUL     AB
02C9 2400        E     ADD     A,#LOW c_mem+06H
02CB F582              MOV     DPL,A
02CD E4                CLR     A
02CE 3400        E     ADDC    A,#HIGH c_mem+06H
02D0 F583              MOV     DPH,A
02D2 E0                MOVX    A,@DPTR
02D3 FE                MOV     R6,A
02D4 EE                MOV     A,R6
02D5 75F006            MOV     B,#06H
02D8 A4                MUL     AB
02D9 FE                MOV     R6,A
02DA EE                MOV     A,R6
02DB 2F                ADD     A,R7
02DC FF                MOV     R7,A
02DD 900000      R     MOV     DPTR,#k_imu
02E0 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 26  

02E1 FE                MOV     R6,A
02E2 7400        E     MOV     A,#LOW IMU_connected
02E4 2E                ADD     A,R6
02E5 F582              MOV     DPL,A
02E7 E4                CLR     A
02E8 3400        E     ADDC    A,#HIGH IMU_connected
02EA F583              MOV     DPH,A
02EC E0                MOVX    A,@DPTR
02ED FE                MOV     R6,A
02EE EE                MOV     A,R6
02EF 75F005            MOV     B,#05H
02F2 A4                MUL     AB
02F3 2400        E     ADD     A,#LOW c_mem+07H
02F5 F582              MOV     DPL,A
02F7 E4                CLR     A
02F8 3400        E     ADDC    A,#HIGH c_mem+07H
02FA F583              MOV     DPH,A
02FC E0                MOVX    A,@DPTR
02FD FE                MOV     R6,A
02FE EE                MOV     A,R6
02FF C4                SWAP    A
0300 54F0              ANL     A,#0F0H
0302 FE                MOV     R6,A
0303 EE                MOV     A,R6
0304 2F                ADD     A,R7
0305 FF                MOV     R7,A
0306 900000      R     MOV     DPTR,#k_imu
0309 E0                MOVX    A,@DPTR
030A FE                MOV     R6,A
030B 7400        E     MOV     A,#LOW IMU_connected
030D 2E                ADD     A,R6
030E F582              MOV     DPL,A
0310 E4                CLR     A
0311 3400        E     ADDC    A,#HIGH IMU_connected
0313 F583              MOV     DPH,A
0315 E0                MOVX    A,@DPTR
0316 FE                MOV     R6,A
0317 EE                MOV     A,R6
0318 75F005            MOV     B,#05H
031B A4                MUL     AB
031C 2400        E     ADD     A,#LOW c_mem+08H
031E F582              MOV     DPL,A
0320 E4                CLR     A
0321 3400        E     ADDC    A,#HIGH c_mem+08H
0323 F583              MOV     DPH,A
0325 E0                MOVX    A,@DPTR
0326 FE                MOV     R6,A
0327 EE                MOV     A,R6
0328 25E0              ADD     A,ACC
032A FE                MOV     R6,A
032B EE                MOV     A,R6
032C 2F                ADD     A,R7
032D FF                MOV     R7,A
032E EF                MOV     A,R7
032F 2402              ADD     A,#02H
0331 FF                MOV     R7,A
0332 7E00              MOV     R6,#00H
0334 900000      R     MOV     DPTR,#k_imu
0337 E0                MOVX    A,@DPTR
0338 FD                MOV     R5,A
0339 7400        E     MOV     A,#LOW IMU_connected
033B 2D                ADD     A,R5
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 27  

033C F582              MOV     DPL,A
033E E4                CLR     A
033F 3400        E     ADDC    A,#HIGH IMU_connected
0341 F583              MOV     DPH,A
0343 E0                MOVX    A,@DPTR
0344 FD                MOV     R5,A
0345 ED                MOV     A,R5
0346 25E0              ADD     A,ACC
0348 2400        E     ADD     A,#LOW single_imu_size
034A F582              MOV     DPL,A
034C E4                CLR     A
034D 3400        E     ADDC    A,#HIGH single_imu_size
034F F583              MOV     DPH,A
0351 EE                MOV     A,R6
0352 F0                MOVX    @DPTR,A
0353 A3                INC     DPTR
0354 EF                MOV     A,R7
0355 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 258
0356 900000      R     MOV     DPTR,#k_imu
0359 E0                MOVX    A,@DPTR
035A FF                MOV     R7,A
035B 7400        E     MOV     A,#LOW IMU_connected
035D 2F                ADD     A,R7
035E F582              MOV     DPL,A
0360 E4                CLR     A
0361 3400        E     ADDC    A,#HIGH IMU_connected
0363 F583              MOV     DPH,A
0365 E0                MOVX    A,@DPTR
0366 FF                MOV     R7,A
0367 EF                MOV     A,R7
0368 25E0              ADD     A,ACC
036A 2400        E     ADD     A,#LOW single_imu_size
036C F582              MOV     DPL,A
036E E4                CLR     A
036F 3400        E     ADDC    A,#HIGH single_imu_size
0371 F583              MOV     DPH,A
0373 E0                MOVX    A,@DPTR
0374 FE                MOV     R6,A
0375 A3                INC     DPTR
0376 E0                MOVX    A,@DPTR
0377 FF                MOV     R7,A
0378 900000      E     MOV     DPTR,#imus_data_size
037B EE                MOV     A,R6
037C 8FF0              MOV     B,R7
037E 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 259
0381 900000      R     MOV     DPTR,#k_imu
0384 E0                MOVX    A,@DPTR
0385 04                INC     A
0386 F0                MOVX    @DPTR,A
0387 020000      R     LJMP    ?C0029
038A         ?C0030:
                                           ; SOURCE LINE # 260
038A 900000      E     MOV     DPTR,#imus_data_size
038D E4                CLR     A
038E 75F001            MOV     B,#01H
0391 120000      E     LCALL   ?C?IILDX
                                           ; SOURCE LINE # 261
0394 22                RET     
             ; FUNCTION InitIMUgeneral (END)

C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 28  

             ; FUNCTION _ReadIMU (BEGIN)
                                           ; SOURCE LINE # 266
0000 900000      R     MOV     DPTR,#n
0003 EE                MOV     A,R6
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 EF                MOV     A,R7
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 267
                                           ; SOURCE LINE # 268
0008 900000      R     MOV     DPTR,#n
000B E0                MOVX    A,@DPTR
000C FE                MOV     R6,A
000D A3                INC     DPTR
000E E0                MOVX    A,@DPTR
000F FF                MOV     R7,A
0010 900000      E     MOV     DPTR,#c_mem+04H
0013 75F005            MOV     B,#05H
0016 EF                MOV     A,R7
0017 120000      E     LCALL   ?C?OFFXADD
001A EE                MOV     A,R6
001B 75F005            MOV     B,#05H
001E A4                MUL     AB
001F 2583              ADD     A,DPH
0021 F583              MOV     DPH,A
0023 E0                MOVX    A,@DPTR
0024 FF                MOV     R7,A
0025 EF                MOV     A,R7
0026 600B              JZ      ?C0033
0028 900000      R     MOV     DPTR,#n
002B E0                MOVX    A,@DPTR
002C FE                MOV     R6,A
002D A3                INC     DPTR
002E E0                MOVX    A,@DPTR
002F FF                MOV     R7,A
0030 120000      R     LCALL   _ReadAcc
0033         ?C0033:
                                           ; SOURCE LINE # 269
0033 900000      R     MOV     DPTR,#n
0036 E0                MOVX    A,@DPTR
0037 FE                MOV     R6,A
0038 A3                INC     DPTR
0039 E0                MOVX    A,@DPTR
003A FF                MOV     R7,A
003B 900000      E     MOV     DPTR,#c_mem+05H
003E 75F005            MOV     B,#05H
0041 EF                MOV     A,R7
0042 120000      E     LCALL   ?C?OFFXADD
0045 EE                MOV     A,R6
0046 75F005            MOV     B,#05H
0049 A4                MUL     AB
004A 2583              ADD     A,DPH
004C F583              MOV     DPH,A
004E E0                MOVX    A,@DPTR
004F FF                MOV     R7,A
0050 EF                MOV     A,R7
0051 600B              JZ      ?C0034
0053 900000      R     MOV     DPTR,#n
0056 E0                MOVX    A,@DPTR
0057 FE                MOV     R6,A
0058 A3                INC     DPTR
0059 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 29  

005A FF                MOV     R7,A
005B 120000      R     LCALL   _ReadGyro
005E         ?C0034:
                                           ; SOURCE LINE # 270
005E 900000      R     MOV     DPTR,#n
0061 E0                MOVX    A,@DPTR
0062 FE                MOV     R6,A
0063 A3                INC     DPTR
0064 E0                MOVX    A,@DPTR
0065 FF                MOV     R7,A
0066 900000      E     MOV     DPTR,#c_mem+06H
0069 75F005            MOV     B,#05H
006C EF                MOV     A,R7
006D 120000      E     LCALL   ?C?OFFXADD
0070 EE                MOV     A,R6
0071 75F005            MOV     B,#05H
0074 A4                MUL     AB
0075 2583              ADD     A,DPH
0077 F583              MOV     DPH,A
0079 E0                MOVX    A,@DPTR
007A FF                MOV     R7,A
007B EF                MOV     A,R7
007C 600B              JZ      ?C0035
007E 900000      R     MOV     DPTR,#n
0081 E0                MOVX    A,@DPTR
0082 FE                MOV     R6,A
0083 A3                INC     DPTR
0084 E0                MOVX    A,@DPTR
0085 FF                MOV     R7,A
0086 120000      R     LCALL   _ReadMag
0089         ?C0035:
                                           ; SOURCE LINE # 271
0089 900000      R     MOV     DPTR,#n
008C E0                MOVX    A,@DPTR
008D FE                MOV     R6,A
008E A3                INC     DPTR
008F E0                MOVX    A,@DPTR
0090 FF                MOV     R7,A
0091 900000      E     MOV     DPTR,#c_mem+07H
0094 75F005            MOV     B,#05H
0097 EF                MOV     A,R7
0098 120000      E     LCALL   ?C?OFFXADD
009B EE                MOV     A,R6
009C 75F005            MOV     B,#05H
009F A4                MUL     AB
00A0 2583              ADD     A,DPH
00A2 F583              MOV     DPH,A
00A4 E0                MOVX    A,@DPTR
00A5 FF                MOV     R7,A
00A6 EF                MOV     A,R7
00A7 600B              JZ      ?C0036
00A9 900000      R     MOV     DPTR,#n
00AC E0                MOVX    A,@DPTR
00AD FE                MOV     R6,A
00AE A3                INC     DPTR
00AF E0                MOVX    A,@DPTR
00B0 FF                MOV     R7,A
00B1 120000      R     LCALL   _ReadQuat
00B4         ?C0036:
                                           ; SOURCE LINE # 272
00B4 900000      R     MOV     DPTR,#n
00B7 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 30  

00B8 FE                MOV     R6,A
00B9 A3                INC     DPTR
00BA E0                MOVX    A,@DPTR
00BB FF                MOV     R7,A
00BC 900000      E     MOV     DPTR,#c_mem+08H
00BF 75F005            MOV     B,#05H
00C2 EF                MOV     A,R7
00C3 120000      E     LCALL   ?C?OFFXADD
00C6 EE                MOV     A,R6
00C7 75F005            MOV     B,#05H
00CA A4                MUL     AB
00CB 2583              ADD     A,DPH
00CD F583              MOV     DPH,A
00CF E0                MOVX    A,@DPTR
00D0 FF                MOV     R7,A
00D1 EF                MOV     A,R7
00D2 600B              JZ      ?C0038
00D4 900000      R     MOV     DPTR,#n
00D7 E0                MOVX    A,@DPTR
00D8 FE                MOV     R6,A
00D9 A3                INC     DPTR
00DA E0                MOVX    A,@DPTR
00DB FF                MOV     R7,A
00DC 120000      R     LCALL   _ReadTemp
                                           ; SOURCE LINE # 273
00DF         ?C0038:
00DF 22                RET     
             ; FUNCTION _ReadIMU (END)

             ; FUNCTION _ReadAcc (BEGIN)
                                           ; SOURCE LINE # 278
0000 900000      R     MOV     DPTR,#n
0003 EE                MOV     A,R6
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 EF                MOV     A,R7
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 279
                                           ; SOURCE LINE # 280
0008 900000      R     MOV     DPTR,#low
000B E4                CLR     A
000C F0                MOVX    @DPTR,A
000D 900000      R     MOV     DPTR,#high
0010 E4                CLR     A
0011 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 282
0012 900000      R     MOV     DPTR,#n
0015 E0                MOVX    A,@DPTR
0016 FE                MOV     R6,A
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 FF                MOV     R7,A
001A 900000      R     MOV     DPTR,#row
001D EE                MOV     A,R6
001E F0                MOVX    @DPTR,A
001F A3                INC     DPTR
0020 EF                MOV     A,R7
0021 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 285
0022 7F3C              MOV     R7,#03CH
0024 120000      R     LCALL   _ReadControlRegister
0027 900000      R     MOV     DPTR,#low
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 31  

002A EF                MOV     A,R7
002B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 286
002C 120000      R     LCALL   SPI_delay
                                           ; SOURCE LINE # 287
002F 7F3B              MOV     R7,#03BH
0031 120000      R     LCALL   _ReadControlRegister
0034 900000      R     MOV     DPTR,#high
0037 EF                MOV     A,R7
0038 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 288
0039 120000      R     LCALL   SPI_delay
                                           ; SOURCE LINE # 290
003C 900000      R     MOV     DPTR,#high
003F E0                MOVX    A,@DPTR
0040 FF                MOV     R7,A
0041 900000      R     MOV     DPTR,#row
0044 E0                MOVX    A,@DPTR
0045 FC                MOV     R4,A
0046 A3                INC     DPTR
0047 E0                MOVX    A,@DPTR
0048 FD                MOV     R5,A
0049 900000      E     MOV     DPTR,#Accel
004C 75F006            MOV     B,#06H
004F ED                MOV     A,R5
0050 120000      E     LCALL   ?C?OFFXADD
0053 EC                MOV     A,R4
0054 75F006            MOV     B,#06H
0057 A4                MUL     AB
0058 2583              ADD     A,DPH
005A F583              MOV     DPH,A
005C EF                MOV     A,R7
005D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 291
005E 900000      R     MOV     DPTR,#low
0061 E0                MOVX    A,@DPTR
0062 FF                MOV     R7,A
0063 900000      R     MOV     DPTR,#row
0066 E0                MOVX    A,@DPTR
0067 FC                MOV     R4,A
0068 A3                INC     DPTR
0069 E0                MOVX    A,@DPTR
006A FD                MOV     R5,A
006B 900000      E     MOV     DPTR,#Accel+01H
006E 75F006            MOV     B,#06H
0071 ED                MOV     A,R5
0072 120000      E     LCALL   ?C?OFFXADD
0075 EC                MOV     A,R4
0076 75F006            MOV     B,#06H
0079 A4                MUL     AB
007A 2583              ADD     A,DPH
007C F583              MOV     DPH,A
007E EF                MOV     A,R7
007F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 292
0080 900000      R     MOV     DPTR,#low
0083 E4                CLR     A
0084 F0                MOVX    @DPTR,A
0085 900000      R     MOV     DPTR,#high
0088 E4                CLR     A
0089 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 295
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 32  

008A 7F3E              MOV     R7,#03EH
008C 120000      R     LCALL   _ReadControlRegister
008F 900000      R     MOV     DPTR,#low
0092 EF                MOV     A,R7
0093 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 296
0094 120000      R     LCALL   SPI_delay
                                           ; SOURCE LINE # 297
0097 7F3D              MOV     R7,#03DH
0099 120000      R     LCALL   _ReadControlRegister
009C 900000      R     MOV     DPTR,#high
009F EF                MOV     A,R7
00A0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 298
00A1 120000      R     LCALL   SPI_delay
                                           ; SOURCE LINE # 300
00A4 900000      R     MOV     DPTR,#high
00A7 E0                MOVX    A,@DPTR
00A8 FF                MOV     R7,A
00A9 900000      R     MOV     DPTR,#row
00AC E0                MOVX    A,@DPTR
00AD FC                MOV     R4,A
00AE A3                INC     DPTR
00AF E0                MOVX    A,@DPTR
00B0 FD                MOV     R5,A
00B1 900000      E     MOV     DPTR,#Accel+02H
00B4 75F006            MOV     B,#06H
00B7 ED                MOV     A,R5
00B8 120000      E     LCALL   ?C?OFFXADD
00BB EC                MOV     A,R4
00BC 75F006            MOV     B,#06H
00BF A4                MUL     AB
00C0 2583              ADD     A,DPH
00C2 F583              MOV     DPH,A
00C4 EF                MOV     A,R7
00C5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 301
00C6 900000      R     MOV     DPTR,#low
00C9 E0                MOVX    A,@DPTR
00CA FF                MOV     R7,A
00CB 900000      R     MOV     DPTR,#row
00CE E0                MOVX    A,@DPTR
00CF FC                MOV     R4,A
00D0 A3                INC     DPTR
00D1 E0                MOVX    A,@DPTR
00D2 FD                MOV     R5,A
00D3 900000      E     MOV     DPTR,#Accel+03H
00D6 75F006            MOV     B,#06H
00D9 ED                MOV     A,R5
00DA 120000      E     LCALL   ?C?OFFXADD
00DD EC                MOV     A,R4
00DE 75F006            MOV     B,#06H
00E1 A4                MUL     AB
00E2 2583              ADD     A,DPH
00E4 F583              MOV     DPH,A
00E6 EF                MOV     A,R7
00E7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 302
00E8 900000      R     MOV     DPTR,#low
00EB E4                CLR     A
00EC F0                MOVX    @DPTR,A
00ED 900000      R     MOV     DPTR,#high
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 33  

00F0 E4                CLR     A
00F1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 305
00F2 7F40              MOV     R7,#040H
00F4 120000      R     LCALL   _ReadControlRegister
00F7 900000      R     MOV     DPTR,#low
00FA EF                MOV     A,R7
00FB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 306
00FC 120000      R     LCALL   SPI_delay
                                           ; SOURCE LINE # 307
00FF 7F3F              MOV     R7,#03FH
0101 120000      R     LCALL   _ReadControlRegister
0104 900000      R     MOV     DPTR,#high
0107 EF                MOV     A,R7
0108 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 308
0109 120000      R     LCALL   SPI_delay
                                           ; SOURCE LINE # 310
010C 900000      R     MOV     DPTR,#high
010F E0                MOVX    A,@DPTR
0110 FF                MOV     R7,A
0111 900000      R     MOV     DPTR,#row
0114 E0                MOVX    A,@DPTR
0115 FC                MOV     R4,A
0116 A3                INC     DPTR
0117 E0                MOVX    A,@DPTR
0118 FD                MOV     R5,A
0119 900000      E     MOV     DPTR,#Accel+04H
011C 75F006            MOV     B,#06H
011F ED                MOV     A,R5
0120 120000      E     LCALL   ?C?OFFXADD
0123 EC                MOV     A,R4
0124 75F006            MOV     B,#06H
0127 A4                MUL     AB
0128 2583              ADD     A,DPH
012A F583              MOV     DPH,A
012C EF                MOV     A,R7
012D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 311
012E 900000      R     MOV     DPTR,#low
0131 E0                MOVX    A,@DPTR
0132 FF                MOV     R7,A
0133 900000      R     MOV     DPTR,#row
0136 E0                MOVX    A,@DPTR
0137 FC                MOV     R4,A
0138 A3                INC     DPTR
0139 E0                MOVX    A,@DPTR
013A FD                MOV     R5,A
013B 900000      E     MOV     DPTR,#Accel+05H
013E 75F006            MOV     B,#06H
0141 ED                MOV     A,R5
0142 120000      E     LCALL   ?C?OFFXADD
0145 EC                MOV     A,R4
0146 75F006            MOV     B,#06H
0149 A4                MUL     AB
014A 2583              ADD     A,DPH
014C F583              MOV     DPH,A
014E EF                MOV     A,R7
014F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 312
0150 900000      R     MOV     DPTR,#low
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 34  

0153 E4                CLR     A
0154 F0                MOVX    @DPTR,A
0155 900000      R     MOV     DPTR,#high
0158 E4                CLR     A
0159 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 313
015A 22                RET     
             ; FUNCTION _ReadAcc (END)

             ; FUNCTION _ReadGyro (BEGIN)
                                           ; SOURCE LINE # 318
0000 900000      R     MOV     DPTR,#n
0003 EE                MOV     A,R6
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 EF                MOV     A,R7
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 319
0008 900000      R     MOV     DPTR,#low
000B E4                CLR     A
000C F0                MOVX    @DPTR,A
000D 900000      R     MOV     DPTR,#high
0010 E4                CLR     A
0011 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 321
0012 900000      R     MOV     DPTR,#n
0015 E0                MOVX    A,@DPTR
0016 FE                MOV     R6,A
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 FF                MOV     R7,A
001A 900000      R     MOV     DPTR,#row
001D EE                MOV     A,R6
001E F0                MOVX    @DPTR,A
001F A3                INC     DPTR
0020 EF                MOV     A,R7
0021 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 324
0022 7F44              MOV     R7,#044H
0024 120000      R     LCALL   _ReadControlRegister
0027 900000      R     MOV     DPTR,#low
002A EF                MOV     A,R7
002B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 325
002C 120000      R     LCALL   SPI_delay
                                           ; SOURCE LINE # 326
002F 7F43              MOV     R7,#043H
0031 120000      R     LCALL   _ReadControlRegister
0034 900000      R     MOV     DPTR,#high
0037 EF                MOV     A,R7
0038 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 327
0039 120000      R     LCALL   SPI_delay
                                           ; SOURCE LINE # 329
003C 900000      R     MOV     DPTR,#high
003F E0                MOVX    A,@DPTR
0040 FF                MOV     R7,A
0041 900000      R     MOV     DPTR,#row
0044 E0                MOVX    A,@DPTR
0045 FC                MOV     R4,A
0046 A3                INC     DPTR
0047 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 35  

0048 FD                MOV     R5,A
0049 900000      E     MOV     DPTR,#Gyro
004C 75F006            MOV     B,#06H
004F ED                MOV     A,R5
0050 120000      E     LCALL   ?C?OFFXADD
0053 EC                MOV     A,R4
0054 75F006            MOV     B,#06H
0057 A4                MUL     AB
0058 2583              ADD     A,DPH
005A F583              MOV     DPH,A
005C EF                MOV     A,R7
005D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 330
005E 900000      R     MOV     DPTR,#low
0061 E0                MOVX    A,@DPTR
0062 FF                MOV     R7,A
0063 900000      R     MOV     DPTR,#row
0066 E0                MOVX    A,@DPTR
0067 FC                MOV     R4,A
0068 A3                INC     DPTR
0069 E0                MOVX    A,@DPTR
006A FD                MOV     R5,A
006B 900000      E     MOV     DPTR,#Gyro+01H
006E 75F006            MOV     B,#06H
0071 ED                MOV     A,R5
0072 120000      E     LCALL   ?C?OFFXADD
0075 EC                MOV     A,R4
0076 75F006            MOV     B,#06H
0079 A4                MUL     AB
007A 2583              ADD     A,DPH
007C F583              MOV     DPH,A
007E EF                MOV     A,R7
007F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 331
0080 900000      R     MOV     DPTR,#low
0083 E4                CLR     A
0084 F0                MOVX    @DPTR,A
0085 900000      R     MOV     DPTR,#high
0088 E4                CLR     A
0089 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 334
008A 7F46              MOV     R7,#046H
008C 120000      R     LCALL   _ReadControlRegister
008F 900000      R     MOV     DPTR,#low
0092 EF                MOV     A,R7
0093 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 335
0094 120000      R     LCALL   SPI_delay
                                           ; SOURCE LINE # 336
0097 7F45              MOV     R7,#045H
0099 120000      R     LCALL   _ReadControlRegister
009C 900000      R     MOV     DPTR,#high
009F EF                MOV     A,R7
00A0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 337
00A1 120000      R     LCALL   SPI_delay
                                           ; SOURCE LINE # 339
00A4 900000      R     MOV     DPTR,#high
00A7 E0                MOVX    A,@DPTR
00A8 FF                MOV     R7,A
00A9 900000      R     MOV     DPTR,#row
00AC E0                MOVX    A,@DPTR
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 36  

00AD FC                MOV     R4,A
00AE A3                INC     DPTR
00AF E0                MOVX    A,@DPTR
00B0 FD                MOV     R5,A
00B1 900000      E     MOV     DPTR,#Gyro+02H
00B4 75F006            MOV     B,#06H
00B7 ED                MOV     A,R5
00B8 120000      E     LCALL   ?C?OFFXADD
00BB EC                MOV     A,R4
00BC 75F006            MOV     B,#06H
00BF A4                MUL     AB
00C0 2583              ADD     A,DPH
00C2 F583              MOV     DPH,A
00C4 EF                MOV     A,R7
00C5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 340
00C6 900000      R     MOV     DPTR,#low
00C9 E0                MOVX    A,@DPTR
00CA FF                MOV     R7,A
00CB 900000      R     MOV     DPTR,#row
00CE E0                MOVX    A,@DPTR
00CF FC                MOV     R4,A
00D0 A3                INC     DPTR
00D1 E0                MOVX    A,@DPTR
00D2 FD                MOV     R5,A
00D3 900000      E     MOV     DPTR,#Gyro+03H
00D6 75F006            MOV     B,#06H
00D9 ED                MOV     A,R5
00DA 120000      E     LCALL   ?C?OFFXADD
00DD EC                MOV     A,R4
00DE 75F006            MOV     B,#06H
00E1 A4                MUL     AB
00E2 2583              ADD     A,DPH
00E4 F583              MOV     DPH,A
00E6 EF                MOV     A,R7
00E7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 341
00E8 900000      R     MOV     DPTR,#low
00EB E4                CLR     A
00EC F0                MOVX    @DPTR,A
00ED 900000      R     MOV     DPTR,#high
00F0 E4                CLR     A
00F1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 344
00F2 7F48              MOV     R7,#048H
00F4 120000      R     LCALL   _ReadControlRegister
00F7 900000      R     MOV     DPTR,#low
00FA EF                MOV     A,R7
00FB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 345
00FC 120000      R     LCALL   SPI_delay
                                           ; SOURCE LINE # 346
00FF 7F47              MOV     R7,#047H
0101 120000      R     LCALL   _ReadControlRegister
0104 900000      R     MOV     DPTR,#high
0107 EF                MOV     A,R7
0108 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 347
0109 120000      R     LCALL   SPI_delay
                                           ; SOURCE LINE # 349
010C 900000      R     MOV     DPTR,#high
010F E0                MOVX    A,@DPTR
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 37  

0110 FF                MOV     R7,A
0111 900000      R     MOV     DPTR,#row
0114 E0                MOVX    A,@DPTR
0115 FC                MOV     R4,A
0116 A3                INC     DPTR
0117 E0                MOVX    A,@DPTR
0118 FD                MOV     R5,A
0119 900000      E     MOV     DPTR,#Gyro+04H
011C 75F006            MOV     B,#06H
011F ED                MOV     A,R5
0120 120000      E     LCALL   ?C?OFFXADD
0123 EC                MOV     A,R4
0124 75F006            MOV     B,#06H
0127 A4                MUL     AB
0128 2583              ADD     A,DPH
012A F583              MOV     DPH,A
012C EF                MOV     A,R7
012D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 350
012E 900000      R     MOV     DPTR,#low
0131 E0                MOVX    A,@DPTR
0132 FF                MOV     R7,A
0133 900000      R     MOV     DPTR,#row
0136 E0                MOVX    A,@DPTR
0137 FC                MOV     R4,A
0138 A3                INC     DPTR
0139 E0                MOVX    A,@DPTR
013A FD                MOV     R5,A
013B 900000      E     MOV     DPTR,#Gyro+05H
013E 75F006            MOV     B,#06H
0141 ED                MOV     A,R5
0142 120000      E     LCALL   ?C?OFFXADD
0145 EC                MOV     A,R4
0146 75F006            MOV     B,#06H
0149 A4                MUL     AB
014A 2583              ADD     A,DPH
014C F583              MOV     DPH,A
014E EF                MOV     A,R7
014F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 352
0150 900000      R     MOV     DPTR,#low
0153 E4                CLR     A
0154 F0                MOVX    @DPTR,A
0155 900000      R     MOV     DPTR,#high
0158 E4                CLR     A
0159 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 353
015A 22                RET     
             ; FUNCTION _ReadGyro (END)

             ; FUNCTION _ReadMag (BEGIN)
                                           ; SOURCE LINE # 358
0000 900000      R     MOV     DPTR,#n
0003 EE                MOV     A,R6
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 EF                MOV     A,R7
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 361
0008 900000      R     MOV     DPTR,#n
000B E0                MOVX    A,@DPTR
000C FE                MOV     R6,A
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 38  

000D A3                INC     DPTR
000E E0                MOVX    A,@DPTR
000F FF                MOV     R7,A
0010 900000      R     MOV     DPTR,#row
0013 EE                MOV     A,R6
0014 F0                MOVX    @DPTR,A
0015 A3                INC     DPTR
0016 EF                MOV     A,R7
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 363
0018 7F49              MOV     R7,#049H
001A 120000      R     LCALL   _ReadControlRegister
001D 900000      R     MOV     DPTR,#low
0020 EF                MOV     A,R7
0021 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 364
0022 120000      R     LCALL   SPI_delay
                                           ; SOURCE LINE # 365
0025 7F4A              MOV     R7,#04AH
0027 120000      R     LCALL   _ReadControlRegister
002A 900000      R     MOV     DPTR,#high
002D EF                MOV     A,R7
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 366
002F 120000      R     LCALL   SPI_delay
                                           ; SOURCE LINE # 368
0032 900000      R     MOV     DPTR,#high
0035 E0                MOVX    A,@DPTR
0036 FF                MOV     R7,A
0037 900000      R     MOV     DPTR,#row
003A E0                MOVX    A,@DPTR
003B FC                MOV     R4,A
003C A3                INC     DPTR
003D E0                MOVX    A,@DPTR
003E FD                MOV     R5,A
003F 900000      E     MOV     DPTR,#Mag
0042 75F006            MOV     B,#06H
0045 ED                MOV     A,R5
0046 120000      E     LCALL   ?C?OFFXADD
0049 EC                MOV     A,R4
004A 75F006            MOV     B,#06H
004D A4                MUL     AB
004E 2583              ADD     A,DPH
0050 F583              MOV     DPH,A
0052 EF                MOV     A,R7
0053 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 369
0054 900000      R     MOV     DPTR,#low
0057 E0                MOVX    A,@DPTR
0058 FF                MOV     R7,A
0059 900000      R     MOV     DPTR,#row
005C E0                MOVX    A,@DPTR
005D FC                MOV     R4,A
005E A3                INC     DPTR
005F E0                MOVX    A,@DPTR
0060 FD                MOV     R5,A
0061 900000      E     MOV     DPTR,#Mag+01H
0064 75F006            MOV     B,#06H
0067 ED                MOV     A,R5
0068 120000      E     LCALL   ?C?OFFXADD
006B EC                MOV     A,R4
006C 75F006            MOV     B,#06H
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 39  

006F A4                MUL     AB
0070 2583              ADD     A,DPH
0072 F583              MOV     DPH,A
0074 EF                MOV     A,R7
0075 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 370
0076 900000      R     MOV     DPTR,#low
0079 E4                CLR     A
007A F0                MOVX    @DPTR,A
007B 900000      R     MOV     DPTR,#high
007E E4                CLR     A
007F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 373
0080 7F4B              MOV     R7,#04BH
0082 120000      R     LCALL   _ReadControlRegister
0085 900000      R     MOV     DPTR,#low
0088 EF                MOV     A,R7
0089 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 374
008A 120000      R     LCALL   SPI_delay
                                           ; SOURCE LINE # 375
008D 7F4C              MOV     R7,#04CH
008F 120000      R     LCALL   _ReadControlRegister
0092 900000      R     MOV     DPTR,#high
0095 EF                MOV     A,R7
0096 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 376
0097 120000      R     LCALL   SPI_delay
                                           ; SOURCE LINE # 378
009A 900000      R     MOV     DPTR,#high
009D E0                MOVX    A,@DPTR
009E FF                MOV     R7,A
009F 900000      R     MOV     DPTR,#row
00A2 E0                MOVX    A,@DPTR
00A3 FC                MOV     R4,A
00A4 A3                INC     DPTR
00A5 E0                MOVX    A,@DPTR
00A6 FD                MOV     R5,A
00A7 900000      E     MOV     DPTR,#Mag+02H
00AA 75F006            MOV     B,#06H
00AD ED                MOV     A,R5
00AE 120000      E     LCALL   ?C?OFFXADD
00B1 EC                MOV     A,R4
00B2 75F006            MOV     B,#06H
00B5 A4                MUL     AB
00B6 2583              ADD     A,DPH
00B8 F583              MOV     DPH,A
00BA EF                MOV     A,R7
00BB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 379
00BC 900000      R     MOV     DPTR,#low
00BF E0                MOVX    A,@DPTR
00C0 FF                MOV     R7,A
00C1 900000      R     MOV     DPTR,#row
00C4 E0                MOVX    A,@DPTR
00C5 FC                MOV     R4,A
00C6 A3                INC     DPTR
00C7 E0                MOVX    A,@DPTR
00C8 FD                MOV     R5,A
00C9 900000      E     MOV     DPTR,#Mag+03H
00CC 75F006            MOV     B,#06H
00CF ED                MOV     A,R5
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 40  

00D0 120000      E     LCALL   ?C?OFFXADD
00D3 EC                MOV     A,R4
00D4 75F006            MOV     B,#06H
00D7 A4                MUL     AB
00D8 2583              ADD     A,DPH
00DA F583              MOV     DPH,A
00DC EF                MOV     A,R7
00DD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 380
00DE 900000      R     MOV     DPTR,#low
00E1 E4                CLR     A
00E2 F0                MOVX    @DPTR,A
00E3 900000      R     MOV     DPTR,#high
00E6 E4                CLR     A
00E7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 383
00E8 7F4D              MOV     R7,#04DH
00EA 120000      R     LCALL   _ReadControlRegister
00ED 900000      R     MOV     DPTR,#low
00F0 EF                MOV     A,R7
00F1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 384
00F2 120000      R     LCALL   SPI_delay
                                           ; SOURCE LINE # 385
00F5 7F4E              MOV     R7,#04EH
00F7 120000      R     LCALL   _ReadControlRegister
00FA 900000      R     MOV     DPTR,#high
00FD EF                MOV     A,R7
00FE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 386
00FF 120000      R     LCALL   SPI_delay
                                           ; SOURCE LINE # 388
0102 900000      R     MOV     DPTR,#high
0105 E0                MOVX    A,@DPTR
0106 FF                MOV     R7,A
0107 900000      R     MOV     DPTR,#row
010A E0                MOVX    A,@DPTR
010B FC                MOV     R4,A
010C A3                INC     DPTR
010D E0                MOVX    A,@DPTR
010E FD                MOV     R5,A
010F 900000      E     MOV     DPTR,#Mag+04H
0112 75F006            MOV     B,#06H
0115 ED                MOV     A,R5
0116 120000      E     LCALL   ?C?OFFXADD
0119 EC                MOV     A,R4
011A 75F006            MOV     B,#06H
011D A4                MUL     AB
011E 2583              ADD     A,DPH
0120 F583              MOV     DPH,A
0122 EF                MOV     A,R7
0123 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 389
0124 900000      R     MOV     DPTR,#low
0127 E0                MOVX    A,@DPTR
0128 FF                MOV     R7,A
0129 900000      R     MOV     DPTR,#row
012C E0                MOVX    A,@DPTR
012D FC                MOV     R4,A
012E A3                INC     DPTR
012F E0                MOVX    A,@DPTR
0130 FD                MOV     R5,A
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 41  

0131 900000      E     MOV     DPTR,#Mag+05H
0134 75F006            MOV     B,#06H
0137 ED                MOV     A,R5
0138 120000      E     LCALL   ?C?OFFXADD
013B EC                MOV     A,R4
013C 75F006            MOV     B,#06H
013F A4                MUL     AB
0140 2583              ADD     A,DPH
0142 F583              MOV     DPH,A
0144 EF                MOV     A,R7
0145 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 390
0146 900000      R     MOV     DPTR,#low
0149 E4                CLR     A
014A F0                MOVX    @DPTR,A
014B 900000      R     MOV     DPTR,#high
014E E4                CLR     A
014F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 391
0150 22                RET     
             ; FUNCTION _ReadMag (END)

             ; FUNCTION _ReadMagCal (BEGIN)
                                           ; SOURCE LINE # 396
0000 900000      R     MOV     DPTR,#n
0003 EE                MOV     A,R6
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 EF                MOV     A,R7
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 398
0008 900000      R     MOV     DPTR,#read
000B E4                CLR     A
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 399
000D 900000      R     MOV     DPTR,#n
0010 E0                MOVX    A,@DPTR
0011 FE                MOV     R6,A
0012 A3                INC     DPTR
0013 E0                MOVX    A,@DPTR
0014 FF                MOV     R7,A
0015 900000      R     MOV     DPTR,#row
0018 EE                MOV     A,R6
0019 F0                MOVX    @DPTR,A
001A A3                INC     DPTR
001B EF                MOV     A,R7
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 401
001D 7F49              MOV     R7,#049H
001F 120000      R     LCALL   _ReadControlRegister
0022 900000      R     MOV     DPTR,#read
0025 EF                MOV     A,R7
0026 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 402
0027 900000      R     MOV     DPTR,#read
002A E0                MOVX    A,@DPTR
002B FF                MOV     R7,A
002C 900000      R     MOV     DPTR,#row
002F E0                MOVX    A,@DPTR
0030 FC                MOV     R4,A
0031 A3                INC     DPTR
0032 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 42  

0033 FD                MOV     R5,A
0034 900000      E     MOV     DPTR,#MagCal
0037 75F003            MOV     B,#03H
003A ED                MOV     A,R5
003B 120000      E     LCALL   ?C?OFFXADD
003E EC                MOV     A,R4
003F 75F003            MOV     B,#03H
0042 A4                MUL     AB
0043 2583              ADD     A,DPH
0045 F583              MOV     DPH,A
0047 EF                MOV     A,R7
0048 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 403
0049 900000      R     MOV     DPTR,#read
004C E4                CLR     A
004D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 406
004E 7F4A              MOV     R7,#04AH
0050 120000      R     LCALL   _ReadControlRegister
0053 900000      R     MOV     DPTR,#read
0056 EF                MOV     A,R7
0057 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 407
0058 900000      R     MOV     DPTR,#read
005B E0                MOVX    A,@DPTR
005C FF                MOV     R7,A
005D 900000      R     MOV     DPTR,#row
0060 E0                MOVX    A,@DPTR
0061 FC                MOV     R4,A
0062 A3                INC     DPTR
0063 E0                MOVX    A,@DPTR
0064 FD                MOV     R5,A
0065 900000      E     MOV     DPTR,#MagCal+01H
0068 75F003            MOV     B,#03H
006B ED                MOV     A,R5
006C 120000      E     LCALL   ?C?OFFXADD
006F EC                MOV     A,R4
0070 75F003            MOV     B,#03H
0073 A4                MUL     AB
0074 2583              ADD     A,DPH
0076 F583              MOV     DPH,A
0078 EF                MOV     A,R7
0079 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 408
007A 900000      R     MOV     DPTR,#read
007D E4                CLR     A
007E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 411
007F 7F4B              MOV     R7,#04BH
0081 120000      R     LCALL   _ReadControlRegister
0084 900000      R     MOV     DPTR,#read
0087 EF                MOV     A,R7
0088 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 412
0089 900000      R     MOV     DPTR,#read
008C E0                MOVX    A,@DPTR
008D FF                MOV     R7,A
008E 900000      R     MOV     DPTR,#row
0091 E0                MOVX    A,@DPTR
0092 FC                MOV     R4,A
0093 A3                INC     DPTR
0094 E0                MOVX    A,@DPTR
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 43  

0095 FD                MOV     R5,A
0096 900000      E     MOV     DPTR,#MagCal+02H
0099 75F003            MOV     B,#03H
009C ED                MOV     A,R5
009D 120000      E     LCALL   ?C?OFFXADD
00A0 EC                MOV     A,R4
00A1 75F003            MOV     B,#03H
00A4 A4                MUL     AB
00A5 2583              ADD     A,DPH
00A7 F583              MOV     DPH,A
00A9 EF                MOV     A,R7
00AA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 413
00AB 900000      R     MOV     DPTR,#read
00AE E4                CLR     A
00AF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 415
00B0 22                RET     
             ; FUNCTION _ReadMagCal (END)

             ; FUNCTION _ReadQuat (BEGIN)
                                           ; SOURCE LINE # 420
0000 900000      R     MOV     DPTR,#n
0003 EE                MOV     A,R6
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 EF                MOV     A,R7
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 421
                                           ; SOURCE LINE # 422
0008 900000      R     MOV     DPTR,#i
000B E4                CLR     A
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 427
000D 7F00              MOV     R7,#00H
000F 7E00              MOV     R6,#00H
0011 7D00              MOV     R5,#00H
0013 7C00              MOV     R4,#00H
0015 900000      R     MOV     DPTR,#time
0018 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 429
001B 900000      E     MOV     DPTR,#N_IMU_Connected
001E E0                MOVX    A,@DPTR
001F FF                MOV     R7,A
0020 EF                MOV     A,R7
0021 6401              XRL     A,#01H
0023 6003              JZ      $ + 5H
0025 020000      R     LJMP    ?C0050
                                           ; SOURCE LINE # 432
0028 900000      R     MOV     DPTR,#n
002B E0                MOVX    A,@DPTR
002C FE                MOV     R6,A
002D A3                INC     DPTR
002E E0                MOVX    A,@DPTR
002F FF                MOV     R7,A
0030 900000      E     MOV     DPTR,#c_mem+04H
0033 75F005            MOV     B,#05H
0036 EF                MOV     A,R7
0037 120000      E     LCALL   ?C?OFFXADD
003A EE                MOV     A,R6
003B 75F005            MOV     B,#05H
003E A4                MUL     AB
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 44  

003F 2583              ADD     A,DPH
0041 F583              MOV     DPH,A
0043 E0                MOVX    A,@DPTR
0044 FF                MOV     R7,A
0045 EF                MOV     A,R7
0046 700B              JNZ     ?C0044
0048 900000      R     MOV     DPTR,#n
004B E0                MOVX    A,@DPTR
004C FE                MOV     R6,A
004D A3                INC     DPTR
004E E0                MOVX    A,@DPTR
004F FF                MOV     R7,A
0050 120000      R     LCALL   _ReadAcc
0053         ?C0044:
                                           ; SOURCE LINE # 433
0053 900000      R     MOV     DPTR,#n
0056 E0                MOVX    A,@DPTR
0057 FE                MOV     R6,A
0058 A3                INC     DPTR
0059 E0                MOVX    A,@DPTR
005A FF                MOV     R7,A
005B 900000      E     MOV     DPTR,#c_mem+05H
005E 75F005            MOV     B,#05H
0061 EF                MOV     A,R7
0062 120000      E     LCALL   ?C?OFFXADD
0065 EE                MOV     A,R6
0066 75F005            MOV     B,#05H
0069 A4                MUL     AB
006A 2583              ADD     A,DPH
006C F583              MOV     DPH,A
006E E0                MOVX    A,@DPTR
006F FF                MOV     R7,A
0070 EF                MOV     A,R7
0071 700B              JNZ     ?C0045
0073 900000      R     MOV     DPTR,#n
0076 E0                MOVX    A,@DPTR
0077 FE                MOV     R6,A
0078 A3                INC     DPTR
0079 E0                MOVX    A,@DPTR
007A FF                MOV     R7,A
007B 120000      R     LCALL   _ReadGyro
007E         ?C0045:
                                           ; SOURCE LINE # 437
007E 900000      E     MOV     DPTR,#timer_value
0081 120000      E     LCALL   ?C?LLDXDATA0
0084 900000      E     MOV     DPTR,#timer_value0
0087 120000      E     LCALL   ?C?LLDXDATA
008A 120000      E     LCALL   ?C?LSUB
008D E4                CLR     A
008E 120000      E     LCALL   ?C?FCASTL
0091 7B00              MOV     R3,#00H
0093 7A24              MOV     R2,#024H
0095 7974              MOV     R1,#074H
0097 7849              MOV     R0,#049H
0099 120000      E     LCALL   ?C?FPDIV
009C 900000      R     MOV     DPTR,#time
009F 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 442
00A2 900000      R     MOV     DPTR,#n
00A5 E0                MOVX    A,@DPTR
00A6 FE                MOV     R6,A
00A7 A3                INC     DPTR
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 45  

00A8 E0                MOVX    A,@DPTR
00A9 FF                MOV     R7,A
00AA 900000      E     MOV     DPTR,#Accel
00AD 75F006            MOV     B,#06H
00B0 EF                MOV     A,R7
00B1 120000      E     LCALL   ?C?OFFXADD
00B4 EE                MOV     A,R6
00B5 75F006            MOV     B,#06H
00B8 A4                MUL     AB
00B9 2583              ADD     A,DPH
00BB F583              MOV     DPH,A
00BD E0                MOVX    A,@DPTR
00BE FF                MOV     R7,A
00BF 7E00              MOV     R6,#00H
00C1 900000      R     MOV     DPTR,#var_h
00C4 EE                MOV     A,R6
00C5 F0                MOVX    @DPTR,A
00C6 A3                INC     DPTR
00C7 EF                MOV     A,R7
00C8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 443
00C9 900000      R     MOV     DPTR,#n
00CC E0                MOVX    A,@DPTR
00CD FE                MOV     R6,A
00CE A3                INC     DPTR
00CF E0                MOVX    A,@DPTR
00D0 FF                MOV     R7,A
00D1 900000      E     MOV     DPTR,#Accel+01H
00D4 75F006            MOV     B,#06H
00D7 EF                MOV     A,R7
00D8 120000      E     LCALL   ?C?OFFXADD
00DB EE                MOV     A,R6
00DC 75F006            MOV     B,#06H
00DF A4                MUL     AB
00E0 2583              ADD     A,DPH
00E2 F583              MOV     DPH,A
00E4 E0                MOVX    A,@DPTR
00E5 FF                MOV     R7,A
00E6 EF                MOV     A,R7
00E7 FD                MOV     R5,A
00E8 7C00              MOV     R4,#00H
00EA 900000      R     MOV     DPTR,#var_h
00ED E0                MOVX    A,@DPTR
00EE FE                MOV     R6,A
00EF A3                INC     DPTR
00F0 E0                MOVX    A,@DPTR
00F1 FF                MOV     R7,A
00F2 EF                MOV     A,R7
00F3 7F00              MOV     R7,#00H
00F5 FE                MOV     R6,A
00F6 EE                MOV     A,R6
00F7 4C                ORL     A,R4
00F8 FC                MOV     R4,A
00F9 EF                MOV     A,R7
00FA 4D                ORL     A,R5
00FB FD                MOV     R5,A
00FC EC                MOV     A,R4
00FD 120000      E     LCALL   ?C?FCASTI
0100 900000      R     MOV     DPTR,#aP
0103 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 444
0106 900000      R     MOV     DPTR,#n
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 46  

0109 E0                MOVX    A,@DPTR
010A FE                MOV     R6,A
010B A3                INC     DPTR
010C E0                MOVX    A,@DPTR
010D FF                MOV     R7,A
010E 900000      E     MOV     DPTR,#Accel+02H
0111 75F006            MOV     B,#06H
0114 EF                MOV     A,R7
0115 120000      E     LCALL   ?C?OFFXADD
0118 EE                MOV     A,R6
0119 75F006            MOV     B,#06H
011C A4                MUL     AB
011D 2583              ADD     A,DPH
011F F583              MOV     DPH,A
0121 E0                MOVX    A,@DPTR
0122 FF                MOV     R7,A
0123 7E00              MOV     R6,#00H
0125 900000      R     MOV     DPTR,#var_h
0128 EE                MOV     A,R6
0129 F0                MOVX    @DPTR,A
012A A3                INC     DPTR
012B EF                MOV     A,R7
012C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 445
012D 900000      R     MOV     DPTR,#n
0130 E0                MOVX    A,@DPTR
0131 FE                MOV     R6,A
0132 A3                INC     DPTR
0133 E0                MOVX    A,@DPTR
0134 FF                MOV     R7,A
0135 900000      E     MOV     DPTR,#Accel+03H
0138 75F006            MOV     B,#06H
013B EF                MOV     A,R7
013C 120000      E     LCALL   ?C?OFFXADD
013F EE                MOV     A,R6
0140 75F006            MOV     B,#06H
0143 A4                MUL     AB
0144 2583              ADD     A,DPH
0146 F583              MOV     DPH,A
0148 E0                MOVX    A,@DPTR
0149 FF                MOV     R7,A
014A EF                MOV     A,R7
014B FD                MOV     R5,A
014C 7C00              MOV     R4,#00H
014E 900000      R     MOV     DPTR,#var_h
0151 E0                MOVX    A,@DPTR
0152 FE                MOV     R6,A
0153 A3                INC     DPTR
0154 E0                MOVX    A,@DPTR
0155 FF                MOV     R7,A
0156 EF                MOV     A,R7
0157 7F00              MOV     R7,#00H
0159 FE                MOV     R6,A
015A EE                MOV     A,R6
015B 4C                ORL     A,R4
015C FC                MOV     R4,A
015D EF                MOV     A,R7
015E 4D                ORL     A,R5
015F FD                MOV     R5,A
0160 EC                MOV     A,R4
0161 120000      E     LCALL   ?C?FCASTI
0164 900000      R     MOV     DPTR,#aP+04H
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 47  

0167 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 446
016A 900000      R     MOV     DPTR,#n
016D E0                MOVX    A,@DPTR
016E FE                MOV     R6,A
016F A3                INC     DPTR
0170 E0                MOVX    A,@DPTR
0171 FF                MOV     R7,A
0172 900000      E     MOV     DPTR,#Accel+04H
0175 75F006            MOV     B,#06H
0178 EF                MOV     A,R7
0179 120000      E     LCALL   ?C?OFFXADD
017C EE                MOV     A,R6
017D 75F006            MOV     B,#06H
0180 A4                MUL     AB
0181 2583              ADD     A,DPH
0183 F583              MOV     DPH,A
0185 E0                MOVX    A,@DPTR
0186 FF                MOV     R7,A
0187 7E00              MOV     R6,#00H
0189 900000      R     MOV     DPTR,#var_h
018C EE                MOV     A,R6
018D F0                MOVX    @DPTR,A
018E A3                INC     DPTR
018F EF                MOV     A,R7
0190 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 447
0191 900000      R     MOV     DPTR,#n
0194 E0                MOVX    A,@DPTR
0195 FE                MOV     R6,A
0196 A3                INC     DPTR
0197 E0                MOVX    A,@DPTR
0198 FF                MOV     R7,A
0199 900000      E     MOV     DPTR,#Accel+05H
019C 75F006            MOV     B,#06H
019F EF                MOV     A,R7
01A0 120000      E     LCALL   ?C?OFFXADD
01A3 EE                MOV     A,R6
01A4 75F006            MOV     B,#06H
01A7 A4                MUL     AB
01A8 2583              ADD     A,DPH
01AA F583              MOV     DPH,A
01AC E0                MOVX    A,@DPTR
01AD FF                MOV     R7,A
01AE EF                MOV     A,R7
01AF FD                MOV     R5,A
01B0 7C00              MOV     R4,#00H
01B2 900000      R     MOV     DPTR,#var_h
01B5 E0                MOVX    A,@DPTR
01B6 FE                MOV     R6,A
01B7 A3                INC     DPTR
01B8 E0                MOVX    A,@DPTR
01B9 FF                MOV     R7,A
01BA EF                MOV     A,R7
01BB 7F00              MOV     R7,#00H
01BD FE                MOV     R6,A
01BE EE                MOV     A,R6
01BF 4C                ORL     A,R4
01C0 FC                MOV     R4,A
01C1 EF                MOV     A,R7
01C2 4D                ORL     A,R5
01C3 FD                MOV     R5,A
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 48  

01C4 EC                MOV     A,R4
01C5 120000      E     LCALL   ?C?FCASTI
01C8 900000      R     MOV     DPTR,#aP+08H
01CB 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 449
01CE 7F00              MOV     R7,#00H
01D0 7E00              MOV     R6,#00H
01D2 7D00              MOV     R5,#00H
01D4 7C00              MOV     R4,#00H
01D6 900000      R     MOV     DPTR,#g
01D9 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 450
01DC 900000      R     MOV     DPTR,#n
01DF E0                MOVX    A,@DPTR
01E0 FE                MOV     R6,A
01E1 A3                INC     DPTR
01E2 E0                MOVX    A,@DPTR
01E3 FF                MOV     R7,A
01E4 900000      E     MOV     DPTR,#Gyro
01E7 75F006            MOV     B,#06H
01EA EF                MOV     A,R7
01EB 120000      E     LCALL   ?C?OFFXADD
01EE EE                MOV     A,R6
01EF 75F006            MOV     B,#06H
01F2 A4                MUL     AB
01F3 2583              ADD     A,DPH
01F5 F583              MOV     DPH,A
01F7 E0                MOVX    A,@DPTR
01F8 FF                MOV     R7,A
01F9 7E00              MOV     R6,#00H
01FB 900000      R     MOV     DPTR,#var_h
01FE EE                MOV     A,R6
01FF F0                MOVX    @DPTR,A
0200 A3                INC     DPTR
0201 EF                MOV     A,R7
0202 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 451
0203 900000      R     MOV     DPTR,#n
0206 E0                MOVX    A,@DPTR
0207 FE                MOV     R6,A
0208 A3                INC     DPTR
0209 E0                MOVX    A,@DPTR
020A FF                MOV     R7,A
020B 900000      E     MOV     DPTR,#Gyro+01H
020E 75F006            MOV     B,#06H
0211 EF                MOV     A,R7
0212 120000      E     LCALL   ?C?OFFXADD
0215 EE                MOV     A,R6
0216 75F006            MOV     B,#06H
0219 A4                MUL     AB
021A 2583              ADD     A,DPH
021C F583              MOV     DPH,A
021E E0                MOVX    A,@DPTR
021F FF                MOV     R7,A
0220 EF                MOV     A,R7
0221 FD                MOV     R5,A
0222 7C00              MOV     R4,#00H
0224 900000      R     MOV     DPTR,#var_h
0227 E0                MOVX    A,@DPTR
0228 FE                MOV     R6,A
0229 A3                INC     DPTR
022A E0                MOVX    A,@DPTR
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 49  

022B FF                MOV     R7,A
022C EF                MOV     A,R7
022D 7F00              MOV     R7,#00H
022F FE                MOV     R6,A
0230 EE                MOV     A,R6
0231 4C                ORL     A,R4
0232 FC                MOV     R4,A
0233 EF                MOV     A,R7
0234 4D                ORL     A,R5
0235 FD                MOV     R5,A
0236 EC                MOV     A,R4
0237 120000      E     LCALL   ?C?FCASTI
023A 7B54              MOV     R3,#054H
023C 7AA0              MOV     R2,#0A0H
023E 790B              MOV     R1,#0BH
0240 7839              MOV     R0,#039H
0242 120000      E     LCALL   ?C?FPMUL
0245 900000      R     MOV     DPTR,#g+04H
0248 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 452
024B 900000      R     MOV     DPTR,#g+04H
024E 120000      E     LCALL   ?C?LLDXDATA
0251 120000      E     LCALL   _fabs
0254 7BA6              MOV     R3,#0A6H
0256 7A0A              MOV     R2,#0AH
0258 7986              MOV     R1,#086H
025A 783E              MOV     R0,#03EH
025C 120000      E     LCALL   ?C?FPCMP3
025F 6010              JZ      ?C0046
0261 400E              JC      ?C0046
0263 7F00              MOV     R7,#00H
0265 7E00              MOV     R6,#00H
0267 7D00              MOV     R5,#00H
0269 7C00              MOV     R4,#00H
026B 900000      R     MOV     DPTR,#g+04H
026E 120000      E     LCALL   ?C?LSTXDATA
0271         ?C0046:
                                           ; SOURCE LINE # 453
0271 900000      R     MOV     DPTR,#n
0274 E0                MOVX    A,@DPTR
0275 FE                MOV     R6,A
0276 A3                INC     DPTR
0277 E0                MOVX    A,@DPTR
0278 FF                MOV     R7,A
0279 900000      E     MOV     DPTR,#Gyro+02H
027C 75F006            MOV     B,#06H
027F EF                MOV     A,R7
0280 120000      E     LCALL   ?C?OFFXADD
0283 EE                MOV     A,R6
0284 75F006            MOV     B,#06H
0287 A4                MUL     AB
0288 2583              ADD     A,DPH
028A F583              MOV     DPH,A
028C E0                MOVX    A,@DPTR
028D FF                MOV     R7,A
028E 7E00              MOV     R6,#00H
0290 900000      R     MOV     DPTR,#var_h
0293 EE                MOV     A,R6
0294 F0                MOVX    @DPTR,A
0295 A3                INC     DPTR
0296 EF                MOV     A,R7
0297 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 50  

                                           ; SOURCE LINE # 454
0298 900000      R     MOV     DPTR,#n
029B E0                MOVX    A,@DPTR
029C FE                MOV     R6,A
029D A3                INC     DPTR
029E E0                MOVX    A,@DPTR
029F FF                MOV     R7,A
02A0 900000      E     MOV     DPTR,#Gyro+03H
02A3 75F006            MOV     B,#06H
02A6 EF                MOV     A,R7
02A7 120000      E     LCALL   ?C?OFFXADD
02AA EE                MOV     A,R6
02AB 75F006            MOV     B,#06H
02AE A4                MUL     AB
02AF 2583              ADD     A,DPH
02B1 F583              MOV     DPH,A
02B3 E0                MOVX    A,@DPTR
02B4 FF                MOV     R7,A
02B5 EF                MOV     A,R7
02B6 FD                MOV     R5,A
02B7 7C00              MOV     R4,#00H
02B9 900000      R     MOV     DPTR,#var_h
02BC E0                MOVX    A,@DPTR
02BD FE                MOV     R6,A
02BE A3                INC     DPTR
02BF E0                MOVX    A,@DPTR
02C0 FF                MOV     R7,A
02C1 EF                MOV     A,R7
02C2 7F00              MOV     R7,#00H
02C4 FE                MOV     R6,A
02C5 EE                MOV     A,R6
02C6 4C                ORL     A,R4
02C7 FC                MOV     R4,A
02C8 EF                MOV     A,R7
02C9 4D                ORL     A,R5
02CA FD                MOV     R5,A
02CB EC                MOV     A,R4
02CC 120000      E     LCALL   ?C?FCASTI
02CF 7B54              MOV     R3,#054H
02D1 7AA0              MOV     R2,#0A0H
02D3 790B              MOV     R1,#0BH
02D5 7839              MOV     R0,#039H
02D7 120000      E     LCALL   ?C?FPMUL
02DA 900000      R     MOV     DPTR,#g+08H
02DD 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 455
02E0 900000      R     MOV     DPTR,#g+08H
02E3 120000      E     LCALL   ?C?LLDXDATA
02E6 120000      E     LCALL   _fabs
02E9 7BA6              MOV     R3,#0A6H
02EB 7A0A              MOV     R2,#0AH
02ED 7986              MOV     R1,#086H
02EF 783E              MOV     R0,#03EH
02F1 120000      E     LCALL   ?C?FPCMP3
02F4 6010              JZ      ?C0047
02F6 400E              JC      ?C0047
02F8 7F00              MOV     R7,#00H
02FA 7E00              MOV     R6,#00H
02FC 7D00              MOV     R5,#00H
02FE 7C00              MOV     R4,#00H
0300 900000      R     MOV     DPTR,#g+08H
0303 120000      E     LCALL   ?C?LSTXDATA
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 51  

0306         ?C0047:
                                           ; SOURCE LINE # 456
0306 900000      R     MOV     DPTR,#n
0309 E0                MOVX    A,@DPTR
030A FE                MOV     R6,A
030B A3                INC     DPTR
030C E0                MOVX    A,@DPTR
030D FF                MOV     R7,A
030E 900000      E     MOV     DPTR,#Gyro+04H
0311 75F006            MOV     B,#06H
0314 EF                MOV     A,R7
0315 120000      E     LCALL   ?C?OFFXADD
0318 EE                MOV     A,R6
0319 75F006            MOV     B,#06H
031C A4                MUL     AB
031D 2583              ADD     A,DPH
031F F583              MOV     DPH,A
0321 E0                MOVX    A,@DPTR
0322 FF                MOV     R7,A
0323 7E00              MOV     R6,#00H
0325 900000      R     MOV     DPTR,#var_h
0328 EE                MOV     A,R6
0329 F0                MOVX    @DPTR,A
032A A3                INC     DPTR
032B EF                MOV     A,R7
032C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 457
032D 900000      R     MOV     DPTR,#n
0330 E0                MOVX    A,@DPTR
0331 FE                MOV     R6,A
0332 A3                INC     DPTR
0333 E0                MOVX    A,@DPTR
0334 FF                MOV     R7,A
0335 900000      E     MOV     DPTR,#Gyro+05H
0338 75F006            MOV     B,#06H
033B EF                MOV     A,R7
033C 120000      E     LCALL   ?C?OFFXADD
033F EE                MOV     A,R6
0340 75F006            MOV     B,#06H
0343 A4                MUL     AB
0344 2583              ADD     A,DPH
0346 F583              MOV     DPH,A
0348 E0                MOVX    A,@DPTR
0349 FF                MOV     R7,A
034A EF                MOV     A,R7
034B FD                MOV     R5,A
034C 7C00              MOV     R4,#00H
034E 900000      R     MOV     DPTR,#var_h
0351 E0                MOVX    A,@DPTR
0352 FE                MOV     R6,A
0353 A3                INC     DPTR
0354 E0                MOVX    A,@DPTR
0355 FF                MOV     R7,A
0356 EF                MOV     A,R7
0357 7F00              MOV     R7,#00H
0359 FE                MOV     R6,A
035A EE                MOV     A,R6
035B 4C                ORL     A,R4
035C FC                MOV     R4,A
035D EF                MOV     A,R7
035E 4D                ORL     A,R5
035F FD                MOV     R5,A
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 52  

0360 EC                MOV     A,R4
0361 120000      E     LCALL   ?C?FCASTI
0364 7B54              MOV     R3,#054H
0366 7AA0              MOV     R2,#0A0H
0368 790B              MOV     R1,#0BH
036A 7839              MOV     R0,#039H
036C 120000      E     LCALL   ?C?FPMUL
036F 900000      R     MOV     DPTR,#g+0CH
0372 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 458
0375 900000      R     MOV     DPTR,#g+0CH
0378 120000      E     LCALL   ?C?LLDXDATA
037B 120000      E     LCALL   _fabs
037E 7BA6              MOV     R3,#0A6H
0380 7A0A              MOV     R2,#0AH
0382 7986              MOV     R1,#086H
0384 783E              MOV     R0,#03EH
0386 120000      E     LCALL   ?C?FPCMP3
0389 6010              JZ      ?C0048
038B 400E              JC      ?C0048
038D 7F00              MOV     R7,#00H
038F 7E00              MOV     R6,#00H
0391 7D00              MOV     R5,#00H
0393 7C00              MOV     R4,#00H
0395 900000      R     MOV     DPTR,#g+0CH
0398 120000      E     LCALL   ?C?LSTXDATA
039B         ?C0048:
                                           ; SOURCE LINE # 461
039B 7B01              MOV     R3,#01H
039D 7A00        R     MOV     R2,#HIGH aP
039F 7900        R     MOV     R1,#LOW aP
03A1 120000      E     LCALL   _v3_normalize
                                           ; SOURCE LINE # 464
03A4 900000      E     MOV     DPTR,#Quat
03A7 120000      E     LCALL   ?C?LLDXDATA
03AA 900000      R     MOV     DPTR,#qL
03AD 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 465
03B0 900000      E     MOV     DPTR,#Quat+04H
03B3 120000      E     LCALL   ?C?LLDXDATA
03B6 900000      R     MOV     DPTR,#qL+04H
03B9 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 466
03BC 900000      E     MOV     DPTR,#Quat+08H
03BF 120000      E     LCALL   ?C?LLDXDATA
03C2 900000      R     MOV     DPTR,#qL+08H
03C5 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 467
03C8 900000      E     MOV     DPTR,#Quat+0CH
03CB 120000      E     LCALL   ?C?LLDXDATA
03CE 900000      R     MOV     DPTR,#qL+0CH
03D1 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 470
03D4 900000      R     MOV     DPTR,#qL+08H
03D7 120000      E     LCALL   ?C?LLDXDATA
03DA 900000      R     MOV     DPTR,#qL
03DD 120000      E     LCALL   ?C?LLDXDATA0
03E0 120000      E     LCALL   ?C?FPMUL
03E3 C004              PUSH    AR4
03E5 C005              PUSH    AR5
03E7 C006              PUSH    AR6
03E9 C007              PUSH    AR7
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 53  

03EB 900000      R     MOV     DPTR,#qL+0CH
03EE 120000      E     LCALL   ?C?LLDXDATA
03F1 900000      R     MOV     DPTR,#qL+04H
03F4 120000      E     LCALL   ?C?LLDXDATA0
03F7 120000      E     LCALL   ?C?FPMUL
03FA D003              POP     AR3
03FC D002              POP     AR2
03FE D001              POP     AR1
0400 D000              POP     AR0
0402 120000      E     LCALL   ?C?FPSUB
0405 7B00              MOV     R3,#00H
0407 7A00              MOV     R2,#00H
0409 7900              MOV     R1,#00H
040B 7840              MOV     R0,#040H
040D 120000      E     LCALL   ?C?FPMUL
0410 900000      R     MOV     DPTR,#aP
0413 120000      E     LCALL   ?C?LLDXDATA0
0416 120000      E     LCALL   ?C?FPSUB
0419 C004              PUSH    AR4
041B C005              PUSH    AR5
041D C006              PUSH    AR6
041F C007              PUSH    AR7
0421 900000      R     MOV     DPTR,#qL+08H
0424 120000      E     LCALL   ?C?LLDXDATA
0427 120000      E     LCALL   ?C?FPNEG
042A A804              MOV     R0,AR4
042C A905              MOV     R1,AR5
042E AA06              MOV     R2,AR6
0430 AB07              MOV     R3,AR7
0432 D007              POP     AR7
0434 D006              POP     AR6
0436 D005              POP     AR5
0438 D004              POP     AR4
043A 120000      E     LCALL   ?C?FPMUL
043D C004              PUSH    AR4
043F C005              PUSH    AR5
0441 C006              PUSH    AR6
0443 C007              PUSH    AR7
0445 900000      R     MOV     DPTR,#qL+0CH
0448 120000      E     LCALL   ?C?LLDXDATA
044B 900000      R     MOV     DPTR,#qL+08H
044E 120000      E     LCALL   ?C?LLDXDATA0
0451 120000      E     LCALL   ?C?FPMUL
0454 C004              PUSH    AR4
0456 C005              PUSH    AR5
0458 C006              PUSH    AR6
045A C007              PUSH    AR7
045C 900000      R     MOV     DPTR,#qL+04H
045F 120000      E     LCALL   ?C?LLDXDATA
0462 900000      R     MOV     DPTR,#qL
0465 120000      E     LCALL   ?C?LLDXDATA0
0468 120000      E     LCALL   ?C?FPMUL
046B A804              MOV     R0,AR4
046D A905              MOV     R1,AR5
046F AA06              MOV     R2,AR6
0471 AB07              MOV     R3,AR7
0473 D007              POP     AR7
0475 D006              POP     AR6
0477 D005              POP     AR5
0479 D004              POP     AR4
047B 120000      E     LCALL   ?C?FPADD
047E 7B00              MOV     R3,#00H
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 54  

0480 7A00              MOV     R2,#00H
0482 7900              MOV     R1,#00H
0484 7840              MOV     R0,#040H
0486 120000      E     LCALL   ?C?FPMUL
0489 900000      R     MOV     DPTR,#aP+04H
048C 120000      E     LCALL   ?C?LLDXDATA0
048F 120000      E     LCALL   ?C?FPSUB
0492 900000      R     MOV     DPTR,#qL+04H
0495 120000      E     LCALL   ?C?LLDXDATA0
0498 120000      E     LCALL   ?C?FPMUL
049B A804              MOV     R0,AR4
049D A905              MOV     R1,AR5
049F AA06              MOV     R2,AR6
04A1 AB07              MOV     R3,AR7
04A3 D007              POP     AR7
04A5 D006              POP     AR6
04A7 D005              POP     AR5
04A9 D004              POP     AR4
04AB 120000      E     LCALL   ?C?FPADD
04AE 7B82              MOV     R3,#082H
04B0 7A51              MOV     R2,#051H
04B2 79C3              MOV     R1,#0C3H
04B4 7840              MOV     R0,#040H
04B6 120000      E     LCALL   ?C?FPMUL
04B9 900000      R     MOV     DPTR,#Napla
04BC 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 471
04BF 900000      R     MOV     DPTR,#qL+0CH
04C2 120000      E     LCALL   ?C?LLDXDATA
04C5 900000      R     MOV     DPTR,#qL+08H
04C8 120000      E     LCALL   ?C?LLDXDATA0
04CB 120000      E     LCALL   ?C?FPMUL
04CE C004              PUSH    AR4
04D0 C005              PUSH    AR5
04D2 C006              PUSH    AR6
04D4 C007              PUSH    AR7
04D6 900000      R     MOV     DPTR,#qL+04H
04D9 120000      E     LCALL   ?C?LLDXDATA
04DC 900000      R     MOV     DPTR,#qL
04DF 120000      E     LCALL   ?C?LLDXDATA0
04E2 120000      E     LCALL   ?C?FPMUL
04E5 A804              MOV     R0,AR4
04E7 A905              MOV     R1,AR5
04E9 AA06              MOV     R2,AR6
04EB AB07              MOV     R3,AR7
04ED D007              POP     AR7
04EF D006              POP     AR6
04F1 D005              POP     AR5
04F3 D004              POP     AR4
04F5 120000      E     LCALL   ?C?FPADD
04F8 7B00              MOV     R3,#00H
04FA 7A00              MOV     R2,#00H
04FC 7900              MOV     R1,#00H
04FE 7840              MOV     R0,#040H
0500 120000      E     LCALL   ?C?FPMUL
0503 900000      R     MOV     DPTR,#aP+04H
0506 120000      E     LCALL   ?C?LLDXDATA0
0509 120000      E     LCALL   ?C?FPSUB
050C 900000      R     MOV     DPTR,#qL
050F 120000      E     LCALL   ?C?LLDXDATA0
0512 120000      E     LCALL   ?C?FPMUL
0515 C004              PUSH    AR4
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 55  

0517 C005              PUSH    AR5
0519 C006              PUSH    AR6
051B C007              PUSH    AR7
051D 900000      R     MOV     DPTR,#qL+08H
0520 120000      E     LCALL   ?C?LLDXDATA
0523 900000      R     MOV     DPTR,#qL
0526 120000      E     LCALL   ?C?LLDXDATA0
0529 120000      E     LCALL   ?C?FPMUL
052C C004              PUSH    AR4
052E C005              PUSH    AR5
0530 C006              PUSH    AR6
0532 C007              PUSH    AR7
0534 900000      R     MOV     DPTR,#qL+0CH
0537 120000      E     LCALL   ?C?LLDXDATA
053A 900000      R     MOV     DPTR,#qL+04H
053D 120000      E     LCALL   ?C?LLDXDATA0
0540 120000      E     LCALL   ?C?FPMUL
0543 D003              POP     AR3
0545 D002              POP     AR2
0547 D001              POP     AR1
0549 D000              POP     AR0
054B 120000      E     LCALL   ?C?FPSUB
054E 7B00              MOV     R3,#00H
0550 7A00              MOV     R2,#00H
0552 7900              MOV     R1,#00H
0554 7840              MOV     R0,#040H
0556 120000      E     LCALL   ?C?FPMUL
0559 900000      R     MOV     DPTR,#aP
055C 120000      E     LCALL   ?C?LLDXDATA0
055F 120000      E     LCALL   ?C?FPSUB
0562 900000      R     MOV     DPTR,#qL+0CH
0565 120000      E     LCALL   ?C?LLDXDATA0
0568 120000      E     LCALL   ?C?FPMUL
056B A804              MOV     R0,AR4
056D A905              MOV     R1,AR5
056F AA06              MOV     R2,AR6
0571 AB07              MOV     R3,AR7
0573 D007              POP     AR7
0575 D006              POP     AR6
0577 D005              POP     AR5
0579 D004              POP     AR4
057B 120000      E     LCALL   ?C?FPADD
057E C004              PUSH    AR4
0580 C005              PUSH    AR5
0582 C006              PUSH    AR6
0584 C007              PUSH    AR7
0586 900000      R     MOV     DPTR,#qL+04H
0589 120000      E     LCALL   ?C?LLDXDATA
058C 900000      R     MOV     DPTR,#qL+04H
058F 120000      E     LCALL   ?C?LLDXDATA0
0592 120000      E     LCALL   ?C?FPMUL
0595 A804              MOV     R0,AR4
0597 A905              MOV     R1,AR5
0599 AA06              MOV     R2,AR6
059B AB07              MOV     R3,AR7
059D 7F00              MOV     R7,#00H
059F 7E00              MOV     R6,#00H
05A1 7D00              MOV     R5,#00H
05A3 7C3F              MOV     R4,#03FH
05A5 120000      E     LCALL   ?C?FPSUB
05A8 C004              PUSH    AR4
05AA C005              PUSH    AR5
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 56  

05AC C006              PUSH    AR6
05AE C007              PUSH    AR7
05B0 900000      R     MOV     DPTR,#qL+08H
05B3 120000      E     LCALL   ?C?LLDXDATA
05B6 900000      R     MOV     DPTR,#qL+08H
05B9 120000      E     LCALL   ?C?LLDXDATA0
05BC 120000      E     LCALL   ?C?FPMUL
05BF A804              MOV     R0,AR4
05C1 A905              MOV     R1,AR5
05C3 AA06              MOV     R2,AR6
05C5 AB07              MOV     R3,AR7
05C7 D007              POP     AR7
05C9 D006              POP     AR6
05CB D005              POP     AR5
05CD D004              POP     AR4
05CF 120000      E     LCALL   ?C?FPSUB
05D2 7B00              MOV     R3,#00H
05D4 7A00              MOV     R2,#00H
05D6 7900              MOV     R1,#00H
05D8 7840              MOV     R0,#040H
05DA 120000      E     LCALL   ?C?FPMUL
05DD 900000      R     MOV     DPTR,#aP+08H
05E0 120000      E     LCALL   ?C?LLDXDATA0
05E3 120000      E     LCALL   ?C?FPSUB
05E6 C004              PUSH    AR4
05E8 C005              PUSH    AR5
05EA C006              PUSH    AR6
05EC C007              PUSH    AR7
05EE 7F00              MOV     R7,#00H
05F0 7E00              MOV     R6,#00H
05F2 7D00              MOV     R5,#00H
05F4 7C40              MOV     R4,#040H
05F6 900000      R     MOV     DPTR,#qL+04H
05F9 120000      E     LCALL   ?C?LLDXDATA0
05FC 120000      E     LCALL   ?C?FPMUL
05FF A804              MOV     R0,AR4
0601 A905              MOV     R1,AR5
0603 AA06              MOV     R2,AR6
0605 AB07              MOV     R3,AR7
0607 D007              POP     AR7
0609 D006              POP     AR6
060B D005              POP     AR5
060D D004              POP     AR4
060F 120000      E     LCALL   ?C?FPMUL
0612 A804              MOV     R0,AR4
0614 A905              MOV     R1,AR5
0616 AA06              MOV     R2,AR6
0618 AB07              MOV     R3,AR7
061A D007              POP     AR7
061C D006              POP     AR6
061E D005              POP     AR5
0620 D004              POP     AR4
0622 120000      E     LCALL   ?C?FPSUB
0625 7B82              MOV     R3,#082H
0627 7A51              MOV     R2,#051H
0629 79C3              MOV     R1,#0C3H
062B 7840              MOV     R0,#040H
062D 120000      E     LCALL   ?C?FPMUL
0630 900000      R     MOV     DPTR,#Napla+04H
0633 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 472
0636 900000      R     MOV     DPTR,#qL+08H
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 57  

0639 120000      E     LCALL   ?C?LLDXDATA
063C 900000      R     MOV     DPTR,#qL
063F 120000      E     LCALL   ?C?LLDXDATA0
0642 120000      E     LCALL   ?C?FPMUL
0645 C004              PUSH    AR4
0647 C005              PUSH    AR5
0649 C006              PUSH    AR6
064B C007              PUSH    AR7
064D 900000      R     MOV     DPTR,#qL+0CH
0650 120000      E     LCALL   ?C?LLDXDATA
0653 900000      R     MOV     DPTR,#qL+04H
0656 120000      E     LCALL   ?C?LLDXDATA0
0659 120000      E     LCALL   ?C?FPMUL
065C D003              POP     AR3
065E D002              POP     AR2
0660 D001              POP     AR1
0662 D000              POP     AR0
0664 120000      E     LCALL   ?C?FPSUB
0667 7B00              MOV     R3,#00H
0669 7A00              MOV     R2,#00H
066B 7900              MOV     R1,#00H
066D 7840              MOV     R0,#040H
066F 120000      E     LCALL   ?C?FPMUL
0672 900000      R     MOV     DPTR,#aP
0675 120000      E     LCALL   ?C?LLDXDATA0
0678 120000      E     LCALL   ?C?FPSUB
067B C004              PUSH    AR4
067D C005              PUSH    AR5
067F C006              PUSH    AR6
0681 C007              PUSH    AR7
0683 900000      R     MOV     DPTR,#qL
0686 120000      E     LCALL   ?C?LLDXDATA
0689 120000      E     LCALL   ?C?FPNEG
068C A804              MOV     R0,AR4
068E A905              MOV     R1,AR5
0690 AA06              MOV     R2,AR6
0692 AB07              MOV     R3,AR7
0694 D007              POP     AR7
0696 D006              POP     AR6
0698 D005              POP     AR5
069A D004              POP     AR4
069C 120000      E     LCALL   ?C?FPMUL
069F C004              PUSH    AR4
06A1 C005              PUSH    AR5
06A3 C006              PUSH    AR6
06A5 C007              PUSH    AR7
06A7 900000      R     MOV     DPTR,#qL+0CH
06AA 120000      E     LCALL   ?C?LLDXDATA
06AD 900000      R     MOV     DPTR,#qL+08H
06B0 120000      E     LCALL   ?C?LLDXDATA0
06B3 120000      E     LCALL   ?C?FPMUL
06B6 C004              PUSH    AR4
06B8 C005              PUSH    AR5
06BA C006              PUSH    AR6
06BC C007              PUSH    AR7
06BE 900000      R     MOV     DPTR,#qL+04H
06C1 120000      E     LCALL   ?C?LLDXDATA
06C4 900000      R     MOV     DPTR,#qL
06C7 120000      E     LCALL   ?C?LLDXDATA0
06CA 120000      E     LCALL   ?C?FPMUL
06CD A804              MOV     R0,AR4
06CF A905              MOV     R1,AR5
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 58  

06D1 AA06              MOV     R2,AR6
06D3 AB07              MOV     R3,AR7
06D5 D007              POP     AR7
06D7 D006              POP     AR6
06D9 D005              POP     AR5
06DB D004              POP     AR4
06DD 120000      E     LCALL   ?C?FPADD
06E0 7B00              MOV     R3,#00H
06E2 7A00              MOV     R2,#00H
06E4 7900              MOV     R1,#00H
06E6 7840              MOV     R0,#040H
06E8 120000      E     LCALL   ?C?FPMUL
06EB 900000      R     MOV     DPTR,#aP+04H
06EE 120000      E     LCALL   ?C?LLDXDATA0
06F1 120000      E     LCALL   ?C?FPSUB
06F4 900000      R     MOV     DPTR,#qL+0CH
06F7 120000      E     LCALL   ?C?LLDXDATA0
06FA 120000      E     LCALL   ?C?FPMUL
06FD A804              MOV     R0,AR4
06FF A905              MOV     R1,AR5
0701 AA06              MOV     R2,AR6
0703 AB07              MOV     R3,AR7
0705 D007              POP     AR7
0707 D006              POP     AR6
0709 D005              POP     AR5
070B D004              POP     AR4
070D 120000      E     LCALL   ?C?FPADD
0710 C004              PUSH    AR4
0712 C005              PUSH    AR5
0714 C006              PUSH    AR6
0716 C007              PUSH    AR7
0718 900000      R     MOV     DPTR,#qL+04H
071B 120000      E     LCALL   ?C?LLDXDATA
071E 900000      R     MOV     DPTR,#qL+04H
0721 120000      E     LCALL   ?C?LLDXDATA0
0724 120000      E     LCALL   ?C?FPMUL
0727 A804              MOV     R0,AR4
0729 A905              MOV     R1,AR5
072B AA06              MOV     R2,AR6
072D AB07              MOV     R3,AR7
072F 7F00              MOV     R7,#00H
0731 7E00              MOV     R6,#00H
0733 7D00              MOV     R5,#00H
0735 7C3F              MOV     R4,#03FH
0737 120000      E     LCALL   ?C?FPSUB
073A C004              PUSH    AR4
073C C005              PUSH    AR5
073E C006              PUSH    AR6
0740 C007              PUSH    AR7
0742 900000      R     MOV     DPTR,#qL+08H
0745 120000      E     LCALL   ?C?LLDXDATA
0748 900000      R     MOV     DPTR,#qL+08H
074B 120000      E     LCALL   ?C?LLDXDATA0
074E 120000      E     LCALL   ?C?FPMUL
0751 A804              MOV     R0,AR4
0753 A905              MOV     R1,AR5
0755 AA06              MOV     R2,AR6
0757 AB07              MOV     R3,AR7
0759 D007              POP     AR7
075B D006              POP     AR6
075D D005              POP     AR5
075F D004              POP     AR4
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 59  

0761 120000      E     LCALL   ?C?FPSUB
0764 7B00              MOV     R3,#00H
0766 7A00              MOV     R2,#00H
0768 7900              MOV     R1,#00H
076A 7840              MOV     R0,#040H
076C 120000      E     LCALL   ?C?FPMUL
076F 900000      R     MOV     DPTR,#aP+08H
0772 120000      E     LCALL   ?C?LLDXDATA0
0775 120000      E     LCALL   ?C?FPSUB
0778 C004              PUSH    AR4
077A C005              PUSH    AR5
077C C006              PUSH    AR6
077E C007              PUSH    AR7
0780 7F00              MOV     R7,#00H
0782 7E00              MOV     R6,#00H
0784 7D00              MOV     R5,#00H
0786 7C40              MOV     R4,#040H
0788 900000      R     MOV     DPTR,#qL+08H
078B 120000      E     LCALL   ?C?LLDXDATA0
078E 120000      E     LCALL   ?C?FPMUL
0791 A804              MOV     R0,AR4
0793 A905              MOV     R1,AR5
0795 AA06              MOV     R2,AR6
0797 AB07              MOV     R3,AR7
0799 D007              POP     AR7
079B D006              POP     AR6
079D D005              POP     AR5
079F D004              POP     AR4
07A1 120000      E     LCALL   ?C?FPMUL
07A4 A804              MOV     R0,AR4
07A6 A905              MOV     R1,AR5
07A8 AA06              MOV     R2,AR6
07AA AB07              MOV     R3,AR7
07AC D007              POP     AR7
07AE D006              POP     AR6
07B0 D005              POP     AR5
07B2 D004              POP     AR4
07B4 120000      E     LCALL   ?C?FPSUB
07B7 7B82              MOV     R3,#082H
07B9 7A51              MOV     R2,#051H
07BB 79C3              MOV     R1,#0C3H
07BD 7840              MOV     R0,#040H
07BF 120000      E     LCALL   ?C?FPMUL
07C2 900000      R     MOV     DPTR,#Napla+08H
07C5 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 473
07C8 900000      R     MOV     DPTR,#qL+0CH
07CB 120000      E     LCALL   ?C?LLDXDATA
07CE 900000      R     MOV     DPTR,#qL+08H
07D1 120000      E     LCALL   ?C?LLDXDATA0
07D4 120000      E     LCALL   ?C?FPMUL
07D7 C004              PUSH    AR4
07D9 C005              PUSH    AR5
07DB C006              PUSH    AR6
07DD C007              PUSH    AR7
07DF 900000      R     MOV     DPTR,#qL+04H
07E2 120000      E     LCALL   ?C?LLDXDATA
07E5 900000      R     MOV     DPTR,#qL
07E8 120000      E     LCALL   ?C?LLDXDATA0
07EB 120000      E     LCALL   ?C?FPMUL
07EE A804              MOV     R0,AR4
07F0 A905              MOV     R1,AR5
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 60  

07F2 AA06              MOV     R2,AR6
07F4 AB07              MOV     R3,AR7
07F6 D007              POP     AR7
07F8 D006              POP     AR6
07FA D005              POP     AR5
07FC D004              POP     AR4
07FE 120000      E     LCALL   ?C?FPADD
0801 7B00              MOV     R3,#00H
0803 7A00              MOV     R2,#00H
0805 7900              MOV     R1,#00H
0807 7840              MOV     R0,#040H
0809 120000      E     LCALL   ?C?FPMUL
080C 900000      R     MOV     DPTR,#aP+04H
080F 120000      E     LCALL   ?C?LLDXDATA0
0812 120000      E     LCALL   ?C?FPSUB
0815 900000      R     MOV     DPTR,#qL+08H
0818 120000      E     LCALL   ?C?LLDXDATA0
081B 120000      E     LCALL   ?C?FPMUL
081E C004              PUSH    AR4
0820 C005              PUSH    AR5
0822 C006              PUSH    AR6
0824 C007              PUSH    AR7
0826 900000      R     MOV     DPTR,#qL+08H
0829 120000      E     LCALL   ?C?LLDXDATA
082C 900000      R     MOV     DPTR,#qL
082F 120000      E     LCALL   ?C?LLDXDATA0
0832 120000      E     LCALL   ?C?FPMUL
0835 C004              PUSH    AR4
0837 C005              PUSH    AR5
0839 C006              PUSH    AR6
083B C007              PUSH    AR7
083D 900000      R     MOV     DPTR,#qL+0CH
0840 120000      E     LCALL   ?C?LLDXDATA
0843 900000      R     MOV     DPTR,#qL+04H
0846 120000      E     LCALL   ?C?LLDXDATA0
0849 120000      E     LCALL   ?C?FPMUL
084C D003              POP     AR3
084E D002              POP     AR2
0850 D001              POP     AR1
0852 D000              POP     AR0
0854 120000      E     LCALL   ?C?FPSUB
0857 7B00              MOV     R3,#00H
0859 7A00              MOV     R2,#00H
085B 7900              MOV     R1,#00H
085D 7840              MOV     R0,#040H
085F 120000      E     LCALL   ?C?FPMUL
0862 900000      R     MOV     DPTR,#aP
0865 120000      E     LCALL   ?C?LLDXDATA0
0868 120000      E     LCALL   ?C?FPSUB
086B 900000      R     MOV     DPTR,#qL+04H
086E 120000      E     LCALL   ?C?LLDXDATA0
0871 120000      E     LCALL   ?C?FPMUL
0874 A804              MOV     R0,AR4
0876 A905              MOV     R1,AR5
0878 AA06              MOV     R2,AR6
087A AB07              MOV     R3,AR7
087C D007              POP     AR7
087E D006              POP     AR6
0880 D005              POP     AR5
0882 D004              POP     AR4
0884 120000      E     LCALL   ?C?FPADD
0887 7B82              MOV     R3,#082H
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 61  

0889 7A51              MOV     R2,#051H
088B 79C3              MOV     R1,#0C3H
088D 7840              MOV     R0,#040H
088F 120000      E     LCALL   ?C?FPMUL
0892 900000      R     MOV     DPTR,#Napla+0CH
0895 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 475
0898 900000      R     MOV     DPTR,#g+08H
089B 120000      E     LCALL   ?C?LLDXDATA
089E 900000      R     MOV     DPTR,#qL+08H
08A1 120000      E     LCALL   ?C?LLDXDATA0
08A4 120000      E     LCALL   ?C?FPMUL
08A7 C004              PUSH    AR4
08A9 C005              PUSH    AR5
08AB C006              PUSH    AR6
08AD C007              PUSH    AR7
08AF 900000      R     MOV     DPTR,#g+04H
08B2 120000      E     LCALL   ?C?LLDXDATA
08B5 900000      R     MOV     DPTR,#qL+04H
08B8 120000      E     LCALL   ?C?LLDXDATA0
08BB 120000      E     LCALL   ?C?FPMUL
08BE A804              MOV     R0,AR4
08C0 A905              MOV     R1,AR5
08C2 AA06              MOV     R2,AR6
08C4 AB07              MOV     R3,AR7
08C6 D007              POP     AR7
08C8 D006              POP     AR6
08CA D005              POP     AR5
08CC D004              POP     AR4
08CE 120000      E     LCALL   ?C?FPADD
08D1 C004              PUSH    AR4
08D3 C005              PUSH    AR5
08D5 C006              PUSH    AR6
08D7 C007              PUSH    AR7
08D9 900000      R     MOV     DPTR,#g+0CH
08DC 120000      E     LCALL   ?C?LLDXDATA
08DF 900000      R     MOV     DPTR,#qL+0CH
08E2 120000      E     LCALL   ?C?LLDXDATA0
08E5 120000      E     LCALL   ?C?FPMUL
08E8 A804              MOV     R0,AR4
08EA A905              MOV     R1,AR5
08EC AA06              MOV     R2,AR6
08EE AB07              MOV     R3,AR7
08F0 D007              POP     AR7
08F2 D006              POP     AR6
08F4 D005              POP     AR5
08F6 D004              POP     AR4
08F8 120000      E     LCALL   ?C?FPADD
08FB 120000      E     LCALL   ?C?FPNEG
08FE 7B00              MOV     R3,#00H
0900 7A00              MOV     R2,#00H
0902 7900              MOV     R1,#00H
0904 783F              MOV     R0,#03FH
0906 120000      E     LCALL   ?C?FPMUL
0909 900000      R     MOV     DPTR,#Napla
090C 120000      E     LCALL   ?C?LLDXDATA0
090F 120000      E     LCALL   ?C?FPSUB
0912 900000      R     MOV     DPTR,#qd0
0915 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 476
0918 900000      R     MOV     DPTR,#g+08H
091B 120000      E     LCALL   ?C?LLDXDATA
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 62  

091E 900000      R     MOV     DPTR,#qL+0CH
0921 120000      E     LCALL   ?C?LLDXDATA0
0924 120000      E     LCALL   ?C?FPMUL
0927 C004              PUSH    AR4
0929 C005              PUSH    AR5
092B C006              PUSH    AR6
092D C007              PUSH    AR7
092F 900000      R     MOV     DPTR,#g+0CH
0932 120000      E     LCALL   ?C?LLDXDATA
0935 900000      R     MOV     DPTR,#qL+08H
0938 120000      E     LCALL   ?C?LLDXDATA0
093B 120000      E     LCALL   ?C?FPMUL
093E D003              POP     AR3
0940 D002              POP     AR2
0942 D001              POP     AR1
0944 D000              POP     AR0
0946 120000      E     LCALL   ?C?FPSUB
0949 C004              PUSH    AR4
094B C005              PUSH    AR5
094D C006              PUSH    AR6
094F C007              PUSH    AR7
0951 900000      R     MOV     DPTR,#g+04H
0954 120000      E     LCALL   ?C?LLDXDATA
0957 900000      R     MOV     DPTR,#qL
095A 120000      E     LCALL   ?C?LLDXDATA0
095D 120000      E     LCALL   ?C?FPMUL
0960 A804              MOV     R0,AR4
0962 A905              MOV     R1,AR5
0964 AA06              MOV     R2,AR6
0966 AB07              MOV     R3,AR7
0968 D007              POP     AR7
096A D006              POP     AR6
096C D005              POP     AR5
096E D004              POP     AR4
0970 120000      E     LCALL   ?C?FPADD
0973 7B00              MOV     R3,#00H
0975 7A00              MOV     R2,#00H
0977 7900              MOV     R1,#00H
0979 783F              MOV     R0,#03FH
097B 120000      E     LCALL   ?C?FPMUL
097E 900000      R     MOV     DPTR,#Napla+04H
0981 120000      E     LCALL   ?C?LLDXDATA0
0984 120000      E     LCALL   ?C?FPSUB
0987 900000      R     MOV     DPTR,#qd1
098A 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 477
098D 900000      R     MOV     DPTR,#g+0CH
0990 120000      E     LCALL   ?C?LLDXDATA
0993 900000      R     MOV     DPTR,#qL+04H
0996 120000      E     LCALL   ?C?LLDXDATA0
0999 120000      E     LCALL   ?C?FPMUL
099C C004              PUSH    AR4
099E C005              PUSH    AR5
09A0 C006              PUSH    AR6
09A2 C007              PUSH    AR7
09A4 900000      R     MOV     DPTR,#g+04H
09A7 120000      E     LCALL   ?C?LLDXDATA
09AA 900000      R     MOV     DPTR,#qL+0CH
09AD 120000      E     LCALL   ?C?LLDXDATA0
09B0 120000      E     LCALL   ?C?FPMUL
09B3 D003              POP     AR3
09B5 D002              POP     AR2
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 63  

09B7 D001              POP     AR1
09B9 D000              POP     AR0
09BB 120000      E     LCALL   ?C?FPSUB
09BE C004              PUSH    AR4
09C0 C005              PUSH    AR5
09C2 C006              PUSH    AR6
09C4 C007              PUSH    AR7
09C6 900000      R     MOV     DPTR,#g+08H
09C9 120000      E     LCALL   ?C?LLDXDATA
09CC 900000      R     MOV     DPTR,#qL
09CF 120000      E     LCALL   ?C?LLDXDATA0
09D2 120000      E     LCALL   ?C?FPMUL
09D5 A804              MOV     R0,AR4
09D7 A905              MOV     R1,AR5
09D9 AA06              MOV     R2,AR6
09DB AB07              MOV     R3,AR7
09DD D007              POP     AR7
09DF D006              POP     AR6
09E1 D005              POP     AR5
09E3 D004              POP     AR4
09E5 120000      E     LCALL   ?C?FPADD
09E8 7B00              MOV     R3,#00H
09EA 7A00              MOV     R2,#00H
09EC 7900              MOV     R1,#00H
09EE 783F              MOV     R0,#03FH
09F0 120000      E     LCALL   ?C?FPMUL
09F3 900000      R     MOV     DPTR,#Napla+08H
09F6 120000      E     LCALL   ?C?LLDXDATA0
09F9 120000      E     LCALL   ?C?FPSUB
09FC 900000      R     MOV     DPTR,#qd2
09FF 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 478
0A02 900000      R     MOV     DPTR,#g+04H
0A05 120000      E     LCALL   ?C?LLDXDATA
0A08 900000      R     MOV     DPTR,#qL+08H
0A0B 120000      E     LCALL   ?C?LLDXDATA0
0A0E 120000      E     LCALL   ?C?FPMUL
0A11 C004              PUSH    AR4
0A13 C005              PUSH    AR5
0A15 C006              PUSH    AR6
0A17 C007              PUSH    AR7
0A19 900000      R     MOV     DPTR,#g+08H
0A1C 120000      E     LCALL   ?C?LLDXDATA
0A1F 900000      R     MOV     DPTR,#qL+04H
0A22 120000      E     LCALL   ?C?LLDXDATA0
0A25 120000      E     LCALL   ?C?FPMUL
0A28 D003              POP     AR3
0A2A D002              POP     AR2
0A2C D001              POP     AR1
0A2E D000              POP     AR0
0A30 120000      E     LCALL   ?C?FPSUB
0A33 C004              PUSH    AR4
0A35 C005              PUSH    AR5
0A37 C006              PUSH    AR6
0A39 C007              PUSH    AR7
0A3B 900000      R     MOV     DPTR,#g+0CH
0A3E 120000      E     LCALL   ?C?LLDXDATA
0A41 900000      R     MOV     DPTR,#qL
0A44 120000      E     LCALL   ?C?LLDXDATA0
0A47 120000      E     LCALL   ?C?FPMUL
0A4A A804              MOV     R0,AR4
0A4C A905              MOV     R1,AR5
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 64  

0A4E AA06              MOV     R2,AR6
0A50 AB07              MOV     R3,AR7
0A52 D007              POP     AR7
0A54 D006              POP     AR6
0A56 D005              POP     AR5
0A58 D004              POP     AR4
0A5A 120000      E     LCALL   ?C?FPADD
0A5D 7B00              MOV     R3,#00H
0A5F 7A00              MOV     R2,#00H
0A61 7900              MOV     R1,#00H
0A63 783F              MOV     R0,#03FH
0A65 120000      E     LCALL   ?C?FPMUL
0A68 900000      R     MOV     DPTR,#Napla+0CH
0A6B 120000      E     LCALL   ?C?LLDXDATA0
0A6E 120000      E     LCALL   ?C?FPSUB
0A71 900000      R     MOV     DPTR,#qd3
0A74 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 480
0A77 900000      R     MOV     DPTR,#qL
0A7A 120000      E     LCALL   ?C?LLDXDATA
0A7D C004              PUSH    AR4
0A7F C005              PUSH    AR5
0A81 C006              PUSH    AR6
0A83 C007              PUSH    AR7
0A85 900000      R     MOV     DPTR,#time
0A88 120000      E     LCALL   ?C?LLDXDATA
0A8B 900000      R     MOV     DPTR,#qd0
0A8E 120000      E     LCALL   ?C?LLDXDATA0
0A91 120000      E     LCALL   ?C?FPMUL
0A94 A804              MOV     R0,AR4
0A96 A905              MOV     R1,AR5
0A98 AA06              MOV     R2,AR6
0A9A AB07              MOV     R3,AR7
0A9C D007              POP     AR7
0A9E D006              POP     AR6
0AA0 D005              POP     AR5
0AA2 D004              POP     AR4
0AA4 120000      E     LCALL   ?C?FPADD
0AA7 900000      R     MOV     DPTR,#qL
0AAA 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 481
0AAD 900000      R     MOV     DPTR,#qL+04H
0AB0 120000      E     LCALL   ?C?LLDXDATA
0AB3 C004              PUSH    AR4
0AB5 C005              PUSH    AR5
0AB7 C006              PUSH    AR6
0AB9 C007              PUSH    AR7
0ABB 900000      R     MOV     DPTR,#time
0ABE 120000      E     LCALL   ?C?LLDXDATA
0AC1 900000      R     MOV     DPTR,#qd1
0AC4 120000      E     LCALL   ?C?LLDXDATA0
0AC7 120000      E     LCALL   ?C?FPMUL
0ACA A804              MOV     R0,AR4
0ACC A905              MOV     R1,AR5
0ACE AA06              MOV     R2,AR6
0AD0 AB07              MOV     R3,AR7
0AD2 D007              POP     AR7
0AD4 D006              POP     AR6
0AD6 D005              POP     AR5
0AD8 D004              POP     AR4
0ADA 120000      E     LCALL   ?C?FPADD
0ADD 900000      R     MOV     DPTR,#qL+04H
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 65  

0AE0 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 482
0AE3 900000      R     MOV     DPTR,#qL+08H
0AE6 120000      E     LCALL   ?C?LLDXDATA
0AE9 C004              PUSH    AR4
0AEB C005              PUSH    AR5
0AED C006              PUSH    AR6
0AEF C007              PUSH    AR7
0AF1 900000      R     MOV     DPTR,#time
0AF4 120000      E     LCALL   ?C?LLDXDATA
0AF7 900000      R     MOV     DPTR,#qd2
0AFA 120000      E     LCALL   ?C?LLDXDATA0
0AFD 120000      E     LCALL   ?C?FPMUL
0B00 A804              MOV     R0,AR4
0B02 A905              MOV     R1,AR5
0B04 AA06              MOV     R2,AR6
0B06 AB07              MOV     R3,AR7
0B08 D007              POP     AR7
0B0A D006              POP     AR6
0B0C D005              POP     AR5
0B0E D004              POP     AR4
0B10 120000      E     LCALL   ?C?FPADD
0B13 900000      R     MOV     DPTR,#qL+08H
0B16 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 483
0B19 900000      R     MOV     DPTR,#qL+0CH
0B1C 120000      E     LCALL   ?C?LLDXDATA
0B1F C004              PUSH    AR4
0B21 C005              PUSH    AR5
0B23 C006              PUSH    AR6
0B25 C007              PUSH    AR7
0B27 900000      R     MOV     DPTR,#time
0B2A 120000      E     LCALL   ?C?LLDXDATA
0B2D 900000      R     MOV     DPTR,#qd3
0B30 120000      E     LCALL   ?C?LLDXDATA0
0B33 120000      E     LCALL   ?C?FPMUL
0B36 A804              MOV     R0,AR4
0B38 A905              MOV     R1,AR5
0B3A AA06              MOV     R2,AR6
0B3C AB07              MOV     R3,AR7
0B3E D007              POP     AR7
0B40 D006              POP     AR6
0B42 D005              POP     AR5
0B44 D004              POP     AR4
0B46 120000      E     LCALL   ?C?FPADD
0B49 900000      R     MOV     DPTR,#qL+0CH
0B4C 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 484
0B4F 7B01              MOV     R3,#01H
0B51 7A00        R     MOV     R2,#HIGH qL
0B53 7900        R     MOV     R1,#LOW qL
0B55 120000      E     LCALL   _v4_normalize
                                           ; SOURCE LINE # 487
0B58 900000      R     MOV     DPTR,#qL
0B5B 120000      E     LCALL   ?C?LLDXDATA
0B5E 900000      E     MOV     DPTR,#Quat
0B61 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 488
0B64 900000      R     MOV     DPTR,#qL+04H
0B67 120000      E     LCALL   ?C?LLDXDATA
0B6A 900000      E     MOV     DPTR,#Quat+04H
0B6D 120000      E     LCALL   ?C?LSTXDATA
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 66  

                                           ; SOURCE LINE # 489
0B70 900000      R     MOV     DPTR,#qL+08H
0B73 120000      E     LCALL   ?C?LLDXDATA
0B76 900000      E     MOV     DPTR,#Quat+08H
0B79 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 490
0B7C 900000      R     MOV     DPTR,#qL+0CH
0B7F 120000      E     LCALL   ?C?LLDXDATA
0B82 900000      E     MOV     DPTR,#Quat+0CH
0B85 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 491
                                           ; SOURCE LINE # 492
                                           ; SOURCE LINE # 494
                                           ; SOURCE LINE # 495
0B88         ?C0050:
0B88 22                RET     
             ; FUNCTION _ReadQuat (END)

             ; FUNCTION ReadAllIMUs (BEGIN)
                                           ; SOURCE LINE # 500
                                           ; SOURCE LINE # 502
0000 900000      R     MOV     DPTR,#tmp
0003 E4                CLR     A
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 E4                CLR     A
0007 F0                MOVX    @DPTR,A
0008 900000      R     MOV     DPTR,#i
000B E4                CLR     A
000C F0                MOVX    @DPTR,A
000D A3                INC     DPTR
000E E4                CLR     A
000F F0                MOVX    @DPTR,A
0010 900000      R     MOV     DPTR,#j
0013 E4                CLR     A
0014 F0                MOVX    @DPTR,A
0015 A3                INC     DPTR
0016 E4                CLR     A
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 503
0018 900000      R     MOV     DPTR,#value
001B E4                CLR     A
001C F0                MOVX    @DPTR,A
001D A3                INC     DPTR
001E E4                CLR     A
001F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 505
0020 900000      R     MOV     DPTR,#k_imu
0023 E4                CLR     A
0024 F0                MOVX    @DPTR,A
0025         ?C0051:
0025 900000      E     MOV     DPTR,#N_IMU_Connected
0028 E0                MOVX    A,@DPTR
0029 FF                MOV     R7,A
002A 900000      R     MOV     DPTR,#k_imu
002D E0                MOVX    A,@DPTR
002E FE                MOV     R6,A
002F EE                MOV     A,R6
0030 C3                CLR     C
0031 9F                SUBB    A,R7
0032 4003              JC      $ + 5H
0034 020000      R     LJMP    ?C0066
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 67  

                                           ; SOURCE LINE # 507
0037 900000      R     MOV     DPTR,#k_imu
003A E0                MOVX    A,@DPTR
003B FF                MOV     R7,A
003C 7400        E     MOV     A,#LOW IMU_connected
003E 2F                ADD     A,R7
003F F582              MOV     DPL,A
0041 E4                CLR     A
0042 3400        E     ADDC    A,#HIGH IMU_connected
0044 F583              MOV     DPH,A
0046 E0                MOVX    A,@DPTR
0047 FF                MOV     R7,A
0048 7E00              MOV     R6,#00H
004A 120000      R     LCALL   _ChipSelector
                                           ; SOURCE LINE # 508
004D 900000      R     MOV     DPTR,#k_imu
0050 E0                MOVX    A,@DPTR
0051 FF                MOV     R7,A
0052 7400        E     MOV     A,#LOW IMU_connected
0054 2F                ADD     A,R7
0055 F582              MOV     DPL,A
0057 E4                CLR     A
0058 3400        E     ADDC    A,#HIGH IMU_connected
005A F583              MOV     DPH,A
005C E0                MOVX    A,@DPTR
005D FF                MOV     R7,A
005E 7E00              MOV     R6,#00H
0060 120000      R     LCALL   _ReadIMU
                                           ; SOURCE LINE # 510
0063 900000      R     MOV     DPTR,#j
0066 E4                CLR     A
0067 F0                MOVX    @DPTR,A
0068 A3                INC     DPTR
0069 E4                CLR     A
006A F0                MOVX    @DPTR,A
006B         ?C0054:
006B 900000      R     MOV     DPTR,#j
006E E0                MOVX    A,@DPTR
006F FE                MOV     R6,A
0070 A3                INC     DPTR
0071 E0                MOVX    A,@DPTR
0072 FF                MOV     R7,A
0073 C3                CLR     C
0074 EF                MOV     A,R7
0075 9403              SUBB    A,#03H
0077 EE                MOV     A,R6
0078 9400              SUBB    A,#00H
007A 4003              JC      $ + 5H
007C 020000      R     LJMP    ?C0055
                                           ; SOURCE LINE # 511
007F 900000      R     MOV     DPTR,#j
0082 E0                MOVX    A,@DPTR
0083 FE                MOV     R6,A
0084 A3                INC     DPTR
0085 E0                MOVX    A,@DPTR
0086 FF                MOV     R7,A
0087 EF                MOV     A,R7
0088 25E0              ADD     A,ACC
008A FF                MOV     R7,A
008B EE                MOV     A,R6
008C 33                RLC     A
008D FE                MOV     R6,A
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 68  

008E 900000      R     MOV     DPTR,#k_imu
0091 E0                MOVX    A,@DPTR
0092 FD                MOV     R5,A
0093 7400        E     MOV     A,#LOW IMU_connected
0095 2D                ADD     A,R5
0096 F582              MOV     DPL,A
0098 E4                CLR     A
0099 3400        E     ADDC    A,#HIGH IMU_connected
009B F583              MOV     DPH,A
009D E0                MOVX    A,@DPTR
009E FD                MOV     R5,A
009F ED                MOV     A,R5
00A0 75F006            MOV     B,#06H
00A3 A4                MUL     AB
00A4 2400        E     ADD     A,#LOW Accel
00A6 F582              MOV     DPL,A
00A8 E4                CLR     A
00A9 3400        E     ADDC    A,#HIGH Accel
00AB F583              MOV     DPH,A
00AD E582              MOV     A,DPL
00AF 2F                ADD     A,R7
00B0 F582              MOV     DPL,A
00B2 E583              MOV     A,DPH
00B4 3E                ADDC    A,R6
00B5 F583              MOV     DPH,A
00B7 E0                MOVX    A,@DPTR
00B8 FF                MOV     R7,A
00B9 7E00              MOV     R6,#00H
00BB 900000      R     MOV     DPTR,#tmp
00BE EE                MOV     A,R6
00BF F0                MOVX    @DPTR,A
00C0 A3                INC     DPTR
00C1 EF                MOV     A,R7
00C2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 512
00C3 900000      R     MOV     DPTR,#j
00C6 E0                MOVX    A,@DPTR
00C7 FE                MOV     R6,A
00C8 A3                INC     DPTR
00C9 E0                MOVX    A,@DPTR
00CA FF                MOV     R7,A
00CB EF                MOV     A,R7
00CC 25E0              ADD     A,ACC
00CE FF                MOV     R7,A
00CF EE                MOV     A,R6
00D0 33                RLC     A
00D1 FE                MOV     R6,A
00D2 900000      R     MOV     DPTR,#k_imu
00D5 E0                MOVX    A,@DPTR
00D6 FD                MOV     R5,A
00D7 7400        E     MOV     A,#LOW IMU_connected
00D9 2D                ADD     A,R5
00DA F582              MOV     DPL,A
00DC E4                CLR     A
00DD 3400        E     ADDC    A,#HIGH IMU_connected
00DF F583              MOV     DPH,A
00E1 E0                MOVX    A,@DPTR
00E2 FD                MOV     R5,A
00E3 ED                MOV     A,R5
00E4 75F006            MOV     B,#06H
00E7 A4                MUL     AB
00E8 2400        E     ADD     A,#LOW Accel+01H
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 69  

00EA F582              MOV     DPL,A
00EC E4                CLR     A
00ED 3400        E     ADDC    A,#HIGH Accel+01H
00EF F583              MOV     DPH,A
00F1 E582              MOV     A,DPL
00F3 2F                ADD     A,R7
00F4 F582              MOV     DPL,A
00F6 E583              MOV     A,DPH
00F8 3E                ADDC    A,R6
00F9 F583              MOV     DPH,A
00FB E0                MOVX    A,@DPTR
00FC FF                MOV     R7,A
00FD EF                MOV     A,R7
00FE FD                MOV     R5,A
00FF 7C00              MOV     R4,#00H
0101 900000      R     MOV     DPTR,#tmp
0104 E0                MOVX    A,@DPTR
0105 FE                MOV     R6,A
0106 A3                INC     DPTR
0107 E0                MOVX    A,@DPTR
0108 FF                MOV     R7,A
0109 EF                MOV     A,R7
010A 7F00              MOV     R7,#00H
010C FE                MOV     R6,A
010D EE                MOV     A,R6
010E 4C                ORL     A,R4
010F FC                MOV     R4,A
0110 EF                MOV     A,R7
0111 4D                ORL     A,R5
0112 FD                MOV     R5,A
0113 900000      R     MOV     DPTR,#j
0116 E0                MOVX    A,@DPTR
0117 FE                MOV     R6,A
0118 A3                INC     DPTR
0119 E0                MOVX    A,@DPTR
011A FF                MOV     R7,A
011B EF                MOV     A,R7
011C 25E0              ADD     A,ACC
011E FF                MOV     R7,A
011F EE                MOV     A,R6
0120 33                RLC     A
0121 FE                MOV     R6,A
0122 900000      R     MOV     DPTR,#k_imu
0125 E0                MOVX    A,@DPTR
0126 FB                MOV     R3,A
0127 75F025            MOV     B,#025H
012A EB                MOV     A,R3
012B 900000      E     MOV     DPTR,#g_imuNew+01H
012E 120000      E     LCALL   ?C?OFFXADD
0131 E582              MOV     A,DPL
0133 2F                ADD     A,R7
0134 F582              MOV     DPL,A
0136 E583              MOV     A,DPH
0138 3E                ADDC    A,R6
0139 F583              MOV     DPH,A
013B EC                MOV     A,R4
013C F0                MOVX    @DPTR,A
013D A3                INC     DPTR
013E ED                MOV     A,R5
013F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 513
0140 900000      R     MOV     DPTR,#j
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 70  

0143 E4                CLR     A
0144 75F001            MOV     B,#01H
0147 120000      E     LCALL   ?C?IILDX
014A 020000      R     LJMP    ?C0054
014D         ?C0055:
                                           ; SOURCE LINE # 515
014D 900000      R     MOV     DPTR,#j
0150 E4                CLR     A
0151 F0                MOVX    @DPTR,A
0152 A3                INC     DPTR
0153 E4                CLR     A
0154 F0                MOVX    @DPTR,A
0155         ?C0057:
0155 900000      R     MOV     DPTR,#j
0158 E0                MOVX    A,@DPTR
0159 FE                MOV     R6,A
015A A3                INC     DPTR
015B E0                MOVX    A,@DPTR
015C FF                MOV     R7,A
015D C3                CLR     C
015E EF                MOV     A,R7
015F 9403              SUBB    A,#03H
0161 EE                MOV     A,R6
0162 9400              SUBB    A,#00H
0164 4003              JC      $ + 5H
0166 020000      R     LJMP    ?C0058
                                           ; SOURCE LINE # 516
0169 900000      R     MOV     DPTR,#j
016C E0                MOVX    A,@DPTR
016D FE                MOV     R6,A
016E A3                INC     DPTR
016F E0                MOVX    A,@DPTR
0170 FF                MOV     R7,A
0171 EF                MOV     A,R7
0172 25E0              ADD     A,ACC
0174 FF                MOV     R7,A
0175 EE                MOV     A,R6
0176 33                RLC     A
0177 FE                MOV     R6,A
0178 900000      R     MOV     DPTR,#k_imu
017B E0                MOVX    A,@DPTR
017C FD                MOV     R5,A
017D 7400        E     MOV     A,#LOW IMU_connected
017F 2D                ADD     A,R5
0180 F582              MOV     DPL,A
0182 E4                CLR     A
0183 3400        E     ADDC    A,#HIGH IMU_connected
0185 F583              MOV     DPH,A
0187 E0                MOVX    A,@DPTR
0188 FD                MOV     R5,A
0189 ED                MOV     A,R5
018A 75F006            MOV     B,#06H
018D A4                MUL     AB
018E 2400        E     ADD     A,#LOW Gyro
0190 F582              MOV     DPL,A
0192 E4                CLR     A
0193 3400        E     ADDC    A,#HIGH Gyro
0195 F583              MOV     DPH,A
0197 E582              MOV     A,DPL
0199 2F                ADD     A,R7
019A F582              MOV     DPL,A
019C E583              MOV     A,DPH
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 71  

019E 3E                ADDC    A,R6
019F F583              MOV     DPH,A
01A1 E0                MOVX    A,@DPTR
01A2 FF                MOV     R7,A
01A3 7E00              MOV     R6,#00H
01A5 900000      R     MOV     DPTR,#tmp
01A8 EE                MOV     A,R6
01A9 F0                MOVX    @DPTR,A
01AA A3                INC     DPTR
01AB EF                MOV     A,R7
01AC F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 517
01AD 900000      R     MOV     DPTR,#j
01B0 E0                MOVX    A,@DPTR
01B1 FE                MOV     R6,A
01B2 A3                INC     DPTR
01B3 E0                MOVX    A,@DPTR
01B4 FF                MOV     R7,A
01B5 EF                MOV     A,R7
01B6 25E0              ADD     A,ACC
01B8 FF                MOV     R7,A
01B9 EE                MOV     A,R6
01BA 33                RLC     A
01BB FE                MOV     R6,A
01BC 900000      R     MOV     DPTR,#k_imu
01BF E0                MOVX    A,@DPTR
01C0 FD                MOV     R5,A
01C1 7400        E     MOV     A,#LOW IMU_connected
01C3 2D                ADD     A,R5
01C4 F582              MOV     DPL,A
01C6 E4                CLR     A
01C7 3400        E     ADDC    A,#HIGH IMU_connected
01C9 F583              MOV     DPH,A
01CB E0                MOVX    A,@DPTR
01CC FD                MOV     R5,A
01CD ED                MOV     A,R5
01CE 75F006            MOV     B,#06H
01D1 A4                MUL     AB
01D2 2400        E     ADD     A,#LOW Gyro+01H
01D4 F582              MOV     DPL,A
01D6 E4                CLR     A
01D7 3400        E     ADDC    A,#HIGH Gyro+01H
01D9 F583              MOV     DPH,A
01DB E582              MOV     A,DPL
01DD 2F                ADD     A,R7
01DE F582              MOV     DPL,A
01E0 E583              MOV     A,DPH
01E2 3E                ADDC    A,R6
01E3 F583              MOV     DPH,A
01E5 E0                MOVX    A,@DPTR
01E6 FF                MOV     R7,A
01E7 EF                MOV     A,R7
01E8 FD                MOV     R5,A
01E9 7C00              MOV     R4,#00H
01EB 900000      R     MOV     DPTR,#tmp
01EE E0                MOVX    A,@DPTR
01EF FE                MOV     R6,A
01F0 A3                INC     DPTR
01F1 E0                MOVX    A,@DPTR
01F2 FF                MOV     R7,A
01F3 EF                MOV     A,R7
01F4 7F00              MOV     R7,#00H
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 72  

01F6 FE                MOV     R6,A
01F7 EE                MOV     A,R6
01F8 4C                ORL     A,R4
01F9 FC                MOV     R4,A
01FA EF                MOV     A,R7
01FB 4D                ORL     A,R5
01FC FD                MOV     R5,A
01FD 900000      R     MOV     DPTR,#j
0200 E0                MOVX    A,@DPTR
0201 FE                MOV     R6,A
0202 A3                INC     DPTR
0203 E0                MOVX    A,@DPTR
0204 FF                MOV     R7,A
0205 EF                MOV     A,R7
0206 25E0              ADD     A,ACC
0208 FF                MOV     R7,A
0209 EE                MOV     A,R6
020A 33                RLC     A
020B FE                MOV     R6,A
020C 900000      R     MOV     DPTR,#k_imu
020F E0                MOVX    A,@DPTR
0210 FB                MOV     R3,A
0211 75F025            MOV     B,#025H
0214 EB                MOV     A,R3
0215 900000      E     MOV     DPTR,#g_imuNew+07H
0218 120000      E     LCALL   ?C?OFFXADD
021B E582              MOV     A,DPL
021D 2F                ADD     A,R7
021E F582              MOV     DPL,A
0220 E583              MOV     A,DPH
0222 3E                ADDC    A,R6
0223 F583              MOV     DPH,A
0225 EC                MOV     A,R4
0226 F0                MOVX    @DPTR,A
0227 A3                INC     DPTR
0228 ED                MOV     A,R5
0229 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 518
022A 900000      R     MOV     DPTR,#j
022D E4                CLR     A
022E 75F001            MOV     B,#01H
0231 120000      E     LCALL   ?C?IILDX
0234 020000      R     LJMP    ?C0057
0237         ?C0058:
                                           ; SOURCE LINE # 520
0237 900000      R     MOV     DPTR,#j
023A E4                CLR     A
023B F0                MOVX    @DPTR,A
023C A3                INC     DPTR
023D E4                CLR     A
023E F0                MOVX    @DPTR,A
023F         ?C0060:
023F 900000      R     MOV     DPTR,#j
0242 E0                MOVX    A,@DPTR
0243 FE                MOV     R6,A
0244 A3                INC     DPTR
0245 E0                MOVX    A,@DPTR
0246 FF                MOV     R7,A
0247 C3                CLR     C
0248 EF                MOV     A,R7
0249 9403              SUBB    A,#03H
024B EE                MOV     A,R6
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 73  

024C 9400              SUBB    A,#00H
024E 4003              JC      $ + 5H
0250 020000      R     LJMP    ?C0061
                                           ; SOURCE LINE # 521
0253 900000      R     MOV     DPTR,#j
0256 E0                MOVX    A,@DPTR
0257 FE                MOV     R6,A
0258 A3                INC     DPTR
0259 E0                MOVX    A,@DPTR
025A FF                MOV     R7,A
025B EF                MOV     A,R7
025C 25E0              ADD     A,ACC
025E FF                MOV     R7,A
025F EE                MOV     A,R6
0260 33                RLC     A
0261 FE                MOV     R6,A
0262 900000      R     MOV     DPTR,#k_imu
0265 E0                MOVX    A,@DPTR
0266 FD                MOV     R5,A
0267 7400        E     MOV     A,#LOW IMU_connected
0269 2D                ADD     A,R5
026A F582              MOV     DPL,A
026C E4                CLR     A
026D 3400        E     ADDC    A,#HIGH IMU_connected
026F F583              MOV     DPH,A
0271 E0                MOVX    A,@DPTR
0272 FD                MOV     R5,A
0273 ED                MOV     A,R5
0274 75F006            MOV     B,#06H
0277 A4                MUL     AB
0278 2400        E     ADD     A,#LOW Mag
027A F582              MOV     DPL,A
027C E4                CLR     A
027D 3400        E     ADDC    A,#HIGH Mag
027F F583              MOV     DPH,A
0281 E582              MOV     A,DPL
0283 2F                ADD     A,R7
0284 F582              MOV     DPL,A
0286 E583              MOV     A,DPH
0288 3E                ADDC    A,R6
0289 F583              MOV     DPH,A
028B E0                MOVX    A,@DPTR
028C FF                MOV     R7,A
028D 7E00              MOV     R6,#00H
028F 900000      R     MOV     DPTR,#tmp
0292 EE                MOV     A,R6
0293 F0                MOVX    @DPTR,A
0294 A3                INC     DPTR
0295 EF                MOV     A,R7
0296 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 522
0297 900000      R     MOV     DPTR,#j
029A E0                MOVX    A,@DPTR
029B FE                MOV     R6,A
029C A3                INC     DPTR
029D E0                MOVX    A,@DPTR
029E FF                MOV     R7,A
029F EF                MOV     A,R7
02A0 25E0              ADD     A,ACC
02A2 FF                MOV     R7,A
02A3 EE                MOV     A,R6
02A4 33                RLC     A
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 74  

02A5 FE                MOV     R6,A
02A6 900000      R     MOV     DPTR,#k_imu
02A9 E0                MOVX    A,@DPTR
02AA FD                MOV     R5,A
02AB 7400        E     MOV     A,#LOW IMU_connected
02AD 2D                ADD     A,R5
02AE F582              MOV     DPL,A
02B0 E4                CLR     A
02B1 3400        E     ADDC    A,#HIGH IMU_connected
02B3 F583              MOV     DPH,A
02B5 E0                MOVX    A,@DPTR
02B6 FD                MOV     R5,A
02B7 ED                MOV     A,R5
02B8 75F006            MOV     B,#06H
02BB A4                MUL     AB
02BC 2400        E     ADD     A,#LOW Mag+01H
02BE F582              MOV     DPL,A
02C0 E4                CLR     A
02C1 3400        E     ADDC    A,#HIGH Mag+01H
02C3 F583              MOV     DPH,A
02C5 E582              MOV     A,DPL
02C7 2F                ADD     A,R7
02C8 F582              MOV     DPL,A
02CA E583              MOV     A,DPH
02CC 3E                ADDC    A,R6
02CD F583              MOV     DPH,A
02CF E0                MOVX    A,@DPTR
02D0 FF                MOV     R7,A
02D1 EF                MOV     A,R7
02D2 FD                MOV     R5,A
02D3 7C00              MOV     R4,#00H
02D5 900000      R     MOV     DPTR,#tmp
02D8 E0                MOVX    A,@DPTR
02D9 FE                MOV     R6,A
02DA A3                INC     DPTR
02DB E0                MOVX    A,@DPTR
02DC FF                MOV     R7,A
02DD EF                MOV     A,R7
02DE 7F00              MOV     R7,#00H
02E0 FE                MOV     R6,A
02E1 EE                MOV     A,R6
02E2 4C                ORL     A,R4
02E3 FC                MOV     R4,A
02E4 EF                MOV     A,R7
02E5 4D                ORL     A,R5
02E6 FD                MOV     R5,A
02E7 900000      R     MOV     DPTR,#j
02EA E0                MOVX    A,@DPTR
02EB FE                MOV     R6,A
02EC A3                INC     DPTR
02ED E0                MOVX    A,@DPTR
02EE FF                MOV     R7,A
02EF EF                MOV     A,R7
02F0 25E0              ADD     A,ACC
02F2 FF                MOV     R7,A
02F3 EE                MOV     A,R6
02F4 33                RLC     A
02F5 FE                MOV     R6,A
02F6 900000      R     MOV     DPTR,#k_imu
02F9 E0                MOVX    A,@DPTR
02FA FB                MOV     R3,A
02FB 75F025            MOV     B,#025H
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 75  

02FE EB                MOV     A,R3
02FF 900000      E     MOV     DPTR,#g_imuNew+0DH
0302 120000      E     LCALL   ?C?OFFXADD
0305 E582              MOV     A,DPL
0307 2F                ADD     A,R7
0308 F582              MOV     DPL,A
030A E583              MOV     A,DPH
030C 3E                ADDC    A,R6
030D F583              MOV     DPH,A
030F EC                MOV     A,R4
0310 F0                MOVX    @DPTR,A
0311 A3                INC     DPTR
0312 ED                MOV     A,R5
0313 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 523
0314 900000      R     MOV     DPTR,#j
0317 E4                CLR     A
0318 75F001            MOV     B,#01H
031B 120000      E     LCALL   ?C?IILDX
031E 020000      R     LJMP    ?C0060
0321         ?C0061:
                                           ; SOURCE LINE # 526
0321 900000      R     MOV     DPTR,#j
0324 E4                CLR     A
0325 F0                MOVX    @DPTR,A
0326 A3                INC     DPTR
0327 E4                CLR     A
0328 F0                MOVX    @DPTR,A
0329         ?C0063:
0329 900000      R     MOV     DPTR,#k_imu
032C E0                MOVX    A,@DPTR
032D FF                MOV     R7,A
032E EF                MOV     A,R7
032F 707D              JNZ     ?C0064
0331 900000      R     MOV     DPTR,#j
0334 E0                MOVX    A,@DPTR
0335 FE                MOV     R6,A
0336 A3                INC     DPTR
0337 E0                MOVX    A,@DPTR
0338 FF                MOV     R7,A
0339 C3                CLR     C
033A EF                MOV     A,R7
033B 9404              SUBB    A,#04H
033D EE                MOV     A,R6
033E 9400              SUBB    A,#00H
0340 506C              JNC     ?C0064
                                           ; SOURCE LINE # 527
0342 900000      R     MOV     DPTR,#j
0345 E0                MOVX    A,@DPTR
0346 FE                MOV     R6,A
0347 A3                INC     DPTR
0348 E0                MOVX    A,@DPTR
0349 FF                MOV     R7,A
034A EF                MOV     A,R7
034B 7802              MOV     R0,#02H
034D         ?C0081:
034D C3                CLR     C
034E 33                RLC     A
034F CE                XCH     A,R6
0350 33                RLC     A
0351 CE                XCH     A,R6
0352 D8F9              DJNZ    R0,?C0081
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 76  

0354 FF                MOV     R7,A
0355 7400        E     MOV     A,#LOW Quat
0357 2F                ADD     A,R7
0358 F582              MOV     DPL,A
035A 7400        E     MOV     A,#HIGH Quat
035C 3E                ADDC    A,R6
035D F583              MOV     DPH,A
035F 120000      E     LCALL   ?C?LLDXDATA
0362 C004              PUSH    AR4
0364 C005              PUSH    AR5
0366 C006              PUSH    AR6
0368 C007              PUSH    AR7
036A 900000      R     MOV     DPTR,#j
036D E0                MOVX    A,@DPTR
036E FE                MOV     R6,A
036F A3                INC     DPTR
0370 E0                MOVX    A,@DPTR
0371 FF                MOV     R7,A
0372 EF                MOV     A,R7
0373 7802              MOV     R0,#02H
0375         ?C0082:
0375 C3                CLR     C
0376 33                RLC     A
0377 CE                XCH     A,R6
0378 33                RLC     A
0379 CE                XCH     A,R6
037A D8F9              DJNZ    R0,?C0082
037C FF                MOV     R7,A
037D 900000      R     MOV     DPTR,#k_imu
0380 E0                MOVX    A,@DPTR
0381 FD                MOV     R5,A
0382 75F025            MOV     B,#025H
0385 ED                MOV     A,R5
0386 900000      E     MOV     DPTR,#g_imuNew+013H
0389 120000      E     LCALL   ?C?OFFXADD
038C E582              MOV     A,DPL
038E 2F                ADD     A,R7
038F F582              MOV     DPL,A
0391 E583              MOV     A,DPH
0393 3E                ADDC    A,R6
0394 F583              MOV     DPH,A
0396 D007              POP     AR7
0398 D006              POP     AR6
039A D005              POP     AR5
039C D004              POP     AR4
039E 120000      E     LCALL   ?C?LSTXDATA
                                           ; SOURCE LINE # 528
03A1 900000      R     MOV     DPTR,#j
03A4 E4                CLR     A
03A5 75F001            MOV     B,#01H
03A8 120000      E     LCALL   ?C?IILDX
03AB 020000      R     LJMP    ?C0063
03AE         ?C0064:
                                           ; SOURCE LINE # 530
03AE 900000      R     MOV     DPTR,#k_imu
03B1 E0                MOVX    A,@DPTR
03B2 FF                MOV     R7,A
03B3 7400        E     MOV     A,#LOW IMU_connected
03B5 2F                ADD     A,R7
03B6 F582              MOV     DPL,A
03B8 E4                CLR     A
03B9 3400        E     ADDC    A,#HIGH IMU_connected
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 77  

03BB F583              MOV     DPH,A
03BD E0                MOVX    A,@DPTR
03BE FF                MOV     R7,A
03BF EF                MOV     A,R7
03C0 25E0              ADD     A,ACC
03C2 2400        E     ADD     A,#LOW Temp
03C4 F582              MOV     DPL,A
03C6 E4                CLR     A
03C7 3400        E     ADDC    A,#HIGH Temp
03C9 F583              MOV     DPH,A
03CB E0                MOVX    A,@DPTR
03CC FF                MOV     R7,A
03CD 7E00              MOV     R6,#00H
03CF 900000      R     MOV     DPTR,#tmp
03D2 EE                MOV     A,R6
03D3 F0                MOVX    @DPTR,A
03D4 A3                INC     DPTR
03D5 EF                MOV     A,R7
03D6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 531
03D7 900000      R     MOV     DPTR,#k_imu
03DA E0                MOVX    A,@DPTR
03DB FF                MOV     R7,A
03DC 7400        E     MOV     A,#LOW IMU_connected
03DE 2F                ADD     A,R7
03DF F582              MOV     DPL,A
03E1 E4                CLR     A
03E2 3400        E     ADDC    A,#HIGH IMU_connected
03E4 F583              MOV     DPH,A
03E6 E0                MOVX    A,@DPTR
03E7 FF                MOV     R7,A
03E8 EF                MOV     A,R7
03E9 25E0              ADD     A,ACC
03EB 2400        E     ADD     A,#LOW Temp+01H
03ED F582              MOV     DPL,A
03EF E4                CLR     A
03F0 3400        E     ADDC    A,#HIGH Temp+01H
03F2 F583              MOV     DPH,A
03F4 E0                MOVX    A,@DPTR
03F5 FF                MOV     R7,A
03F6 EF                MOV     A,R7
03F7 FD                MOV     R5,A
03F8 7C00              MOV     R4,#00H
03FA 900000      R     MOV     DPTR,#tmp
03FD E0                MOVX    A,@DPTR
03FE FE                MOV     R6,A
03FF A3                INC     DPTR
0400 E0                MOVX    A,@DPTR
0401 FF                MOV     R7,A
0402 EF                MOV     A,R7
0403 7F00              MOV     R7,#00H
0405 FE                MOV     R6,A
0406 EE                MOV     A,R6
0407 4C                ORL     A,R4
0408 FE                MOV     R6,A
0409 EF                MOV     A,R7
040A 4D                ORL     A,R5
040B FF                MOV     R7,A
040C 900000      R     MOV     DPTR,#k_imu
040F E0                MOVX    A,@DPTR
0410 FD                MOV     R5,A
0411 75F025            MOV     B,#025H
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 78  

0414 ED                MOV     A,R5
0415 900000      E     MOV     DPTR,#g_imuNew+023H
0418 120000      E     LCALL   ?C?OFFXADD
041B EE                MOV     A,R6
041C F0                MOVX    @DPTR,A
041D A3                INC     DPTR
041E EF                MOV     A,R7
041F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 532
0420 900000      R     MOV     DPTR,#k_imu
0423 E0                MOVX    A,@DPTR
0424 04                INC     A
0425 F0                MOVX    @DPTR,A
0426 020000      R     LJMP    ?C0051
                                           ; SOURCE LINE # 533
0429         ?C0066:
0429 22                RET     
             ; FUNCTION ReadAllIMUs (END)

             ; FUNCTION _ReadTemp (BEGIN)
                                           ; SOURCE LINE # 538
0000 900000      R     MOV     DPTR,#n
0003 EE                MOV     A,R6
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 EF                MOV     A,R7
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 539
                                           ; SOURCE LINE # 540
0008 900000      R     MOV     DPTR,#low
000B E4                CLR     A
000C F0                MOVX    @DPTR,A
000D 900000      R     MOV     DPTR,#high
0010 E4                CLR     A
0011 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 541
0012 900000      R     MOV     DPTR,#n
0015 E0                MOVX    A,@DPTR
0016 FE                MOV     R6,A
0017 A3                INC     DPTR
0018 E0                MOVX    A,@DPTR
0019 FF                MOV     R7,A
001A 900000      R     MOV     DPTR,#row
001D EE                MOV     A,R6
001E F0                MOVX    @DPTR,A
001F A3                INC     DPTR
0020 EF                MOV     A,R7
0021 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 544
0022 7F42              MOV     R7,#042H
0024 120000      R     LCALL   _ReadControlRegister
0027 900000      R     MOV     DPTR,#low
002A EF                MOV     A,R7
002B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 545
002C 120000      R     LCALL   SPI_delay
                                           ; SOURCE LINE # 546
002F 7F41              MOV     R7,#041H
0031 120000      R     LCALL   _ReadControlRegister
0034 900000      R     MOV     DPTR,#high
0037 EF                MOV     A,R7
0038 F0                MOVX    @DPTR,A
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 79  

                                           ; SOURCE LINE # 547
0039 120000      R     LCALL   SPI_delay
                                           ; SOURCE LINE # 549
003C 900000      R     MOV     DPTR,#high
003F E0                MOVX    A,@DPTR
0040 FD                MOV     R5,A
0041 900000      R     MOV     DPTR,#row
0044 E0                MOVX    A,@DPTR
0045 FE                MOV     R6,A
0046 A3                INC     DPTR
0047 E0                MOVX    A,@DPTR
0048 FF                MOV     R7,A
0049 EF                MOV     A,R7
004A 25E0              ADD     A,ACC
004C FF                MOV     R7,A
004D EE                MOV     A,R6
004E 33                RLC     A
004F FE                MOV     R6,A
0050 7400        E     MOV     A,#LOW Temp
0052 2F                ADD     A,R7
0053 F582              MOV     DPL,A
0055 7400        E     MOV     A,#HIGH Temp
0057 3E                ADDC    A,R6
0058 F583              MOV     DPH,A
005A ED                MOV     A,R5
005B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 550
005C 900000      R     MOV     DPTR,#low
005F E0                MOVX    A,@DPTR
0060 FD                MOV     R5,A
0061 900000      R     MOV     DPTR,#row
0064 E0                MOVX    A,@DPTR
0065 FE                MOV     R6,A
0066 A3                INC     DPTR
0067 E0                MOVX    A,@DPTR
0068 FF                MOV     R7,A
0069 EF                MOV     A,R7
006A 25E0              ADD     A,ACC
006C FF                MOV     R7,A
006D EE                MOV     A,R6
006E 33                RLC     A
006F FE                MOV     R6,A
0070 7400        E     MOV     A,#LOW Temp+01H
0072 2F                ADD     A,R7
0073 F582              MOV     DPL,A
0075 7400        E     MOV     A,#HIGH Temp+01H
0077 3E                ADDC    A,R6
0078 F583              MOV     DPH,A
007A ED                MOV     A,R5
007B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 551
007C 900000      R     MOV     DPTR,#low
007F E4                CLR     A
0080 F0                MOVX    @DPTR,A
0081 900000      R     MOV     DPTR,#high
0084 E4                CLR     A
0085 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 552
0086 22                RET     
             ; FUNCTION _ReadTemp (END)

             ; FUNCTION _WriteControlRegister (BEGIN)
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 80  

                                           ; SOURCE LINE # 557
0000 900000      R     MOV     DPTR,#address
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
0005 900000      R     MOV     DPTR,#dta
0008 ED                MOV     A,R5
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 559
000A 120000      E     LCALL   SPI_IMU_ClearRxBuffer
                                           ; SOURCE LINE # 560
000D 120000      E     LCALL   SPI_IMU_ClearTxBuffer
                                           ; SOURCE LINE # 561
0010 120000      E     LCALL   SPI_IMU_ClearFIFO
                                           ; SOURCE LINE # 562
0013 900000      R     MOV     DPTR,#address
0016 E0                MOVX    A,@DPTR
0017 FF                MOV     R7,A
0018 120000      E     LCALL   _SPI_IMU_WriteTxData
001B         ?C0068:
                                           ; SOURCE LINE # 563
001B 120000      E     LCALL   SPI_IMU_ReadStatus
001E EF                MOV     A,R7
001F 30E1F9            JNB     ACC.1,?C0068
0022         ?C0069:
                                           ; SOURCE LINE # 564
0022 900000      R     MOV     DPTR,#dta
0025 E0                MOVX    A,@DPTR
0026 FF                MOV     R7,A
0027 120000      E     LCALL   _SPI_IMU_WriteTxData
002A         ?C0070:
                                           ; SOURCE LINE # 565
002A 120000      E     LCALL   SPI_IMU_ReadStatus
002D EF                MOV     A,R7
002E 30E1F9            JNB     ACC.1,?C0070
0031         ?C0071:
                                           ; SOURCE LINE # 566
0031         ?C0072:
0031 22                RET     
             ; FUNCTION _WriteControlRegister (END)

             ; FUNCTION _ReadControlRegister (BEGIN)
                                           ; SOURCE LINE # 571
0000 900000      R     MOV     DPTR,#address
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 574
0005 900000      R     MOV     DPTR,#address
0008 E0                MOVX    A,@DPTR
0009 FF                MOV     R7,A
000A EF                MOV     A,R7
000B 4480              ORL     A,#080H
000D FF                MOV     R7,A
000E 120000      E     LCALL   _SPI_IMU_WriteTxData
                                           ; SOURCE LINE # 575
0011 7F00              MOV     R7,#00H
0013 120000      E     LCALL   _SPI_IMU_WriteTxData
0016         ?C0073:
                                           ; SOURCE LINE # 576
0016 120000      E     LCALL   SPI_IMU_ReadStatus
0019 EF                MOV     A,R7
001A 30E0F9            JNB     ACC.0,?C0073
001D         ?C0074:
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 81  

                                           ; SOURCE LINE # 577
001D 120000      E     LCALL   SPI_IMU_ReadRxData
0020 900000      R     MOV     DPTR,#controlreg
0023 EF                MOV     A,R7
0024 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 578
0025 900000      R     MOV     DPTR,#controlreg
0028 E0                MOVX    A,@DPTR
0029 FF                MOV     R7,A
                                           ; SOURCE LINE # 579
002A         ?C0075:
002A 22                RET     
             ; FUNCTION _ReadControlRegister (END)

             ; FUNCTION SPI_delay (BEGIN)
                                           ; SOURCE LINE # 584
                                           ; SOURCE LINE # 585
0000 900000      E     MOV     DPTR,#c_mem+03H
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
0005 EF                MOV     A,R7
0006 120000      E     LCALL   ?C?CCASE
0009 0000        R     DW      ?C0077
000B 01                DB      01H
000C 0000        R     DW      ?C0078
000E 02                DB      02H
000F 0000              DW      00H
0011 0000        R     DW      ?C0080
                                           ; SOURCE LINE # 586
0013         ?C0077:
                                           ; SOURCE LINE # 587
0013 7F0A              MOV     R7,#0AH
0015 7E00              MOV     R6,#00H
0017 120000      E     LCALL   _CyDelayUs
                                           ; SOURCE LINE # 588
001A 22                RET     
                                           ; SOURCE LINE # 589
001B         ?C0078:
                                           ; SOURCE LINE # 590
001B 7F64              MOV     R7,#064H
001D 7E00              MOV     R6,#00H
001F 120000      E     LCALL   _CyDelayUs
                                           ; SOURCE LINE # 591
                                           ; SOURCE LINE # 592
                                           ; SOURCE LINE # 593
                                           ; SOURCE LINE # 594
                                           ; SOURCE LINE # 595
0022         ?C0080:
0022 22                RET     
             ; FUNCTION SPI_delay (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   7307    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      1     168
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
C51 COMPILER V9.51   IMU_FUNCTIONS                                                         04/01/2019 12:07:29 PAGE 82  

   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
